## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS08 WAD |
| Severity    | MAJOR |
| Unique ID   | 9080431   |
| Summary     | Is the POP finish for this Control Account WAD before the baseline early finish? |
| Error message | pop_finish < DS04.EF_date where schedule_type = BL (by DS08.WBS_ID & DS04.WBS_ID via DS01.WBS_ID & DS01.parent_WBS_ID). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "POP Finish Before Baseline Early Finish (CA)" is designed to ensure that the Planned Operation Period (POP) finish date for a Control Account Work Authorization Document (WAD) in the DS08 WAD table is not earlier than the baseline early finish date from the DS04 Schedule table.

The error message "pop_finish < DS04.EF_date where schedule_type = BL" indicates that the POP finish date is earlier than the baseline early finish date. This discrepancy could be due to incorrect data entry or a change in the project schedule that has not been reflected in the baseline.

The fields causing the issue are the 'POP_finish_date' in the DS08 WAD table and the 'EF_date' in the DS04 Schedule table. The expected value is that the 'POP_finish_date' should be equal to or later than the 'EF_date' when the 'schedule_type' is 'BL' (Baseline).

The DIQ check is performed by comparing the 'POP_finish_date' for each Control Account WAD with the maximum 'EF_date' for the corresponding Control Account in the DS04 Schedule table. If the 'POP_finish_date' is earlier, the DIQ check will flag this as an error. 

Please ensure that the 'POP_finish_date' in the DS08 WAD table is not earlier than the 'EF_date' in the DS04 Schedule table for the corresponding Control Account. If the dates are correct, please verify that the 'schedule_type' is set to 'BL' (Baseline) in the DS04 Schedule table.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the Planned Operation Period (POP) finish date for a specific Control Account Work Authorization Document (WAD) does not occur before the baseline early finish date. The test is checking if the POP finish date is less than the baseline early finish date, which is a condition that should not occur in a well-managed project schedule. 

The importance of this check is to maintain the integrity of the project schedule and to ensure that the project is not planned to finish any tasks before the baseline early finish date. This is crucial for maintaining accurate and realistic project timelines. 

The severity of this test is marked as a MAJOR, which means that if this issue is not addressed, it is likely to cause problems during the analysis of the project data. It may not stop the data from being reviewed, but it could potentially lead to incorrect conclusions or decisions based on the data. Therefore, it is important to address this issue to ensure accurate project management and planning.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS08_WAD_IsPOPFinishBeforeDS04BLEFDateCA] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with CAFinish as (
		SELECT A.CAWBS, MAX(S.EF_date) EF
		FROM
			DS04_schedule S INNER JOIN (
				SELECT Ancestor_WBS_ID CAWBS, WBS_ID WPWBS 
				FROM AncestryTree_Get(@upload_ID) 
				WHERE type = 'WP' AND Ancestor_Type = 'CA') A ON S.WBS_ID = A.WPWBS
		WHERE
				S.upload_ID = @upload_ID
			AND S.schedule_type = 'BL'
		GROUP BY A.CAWBS
	)
	SELECT 
		W.*
	FROM
		DS08_WAD W 	INNER JOIN CAFinish C ON W.WBS_ID = C.CAWBS
										  AND W.POP_finish_date <> C.EF
					INNER JOIN LatestCAWADRev_Get(@upload_ID) R ON W.WBS_ID = R.WBS_ID
																AND W.auth_PM_date = R.PMAuth 
	WHERE
			upload_ID = @upload_ID  
		AND TRIM(ISNULL(W.WBS_ID_WP,'')) = ''
)
```
