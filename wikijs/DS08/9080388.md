## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS08 WAD |
| Severity    | MAJOR |
| Unique ID   | 9080388   |
| Summary     | Are the labor budget hours for this CA WAD misaligned with what is in cost? |
| Error message | budget_labor_hours <> SUM(DS03.BCWSi_hours) where EOC = labor (by WBS_ID_CA). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "CA Labor Hours Misaligned With Cost" is designed to identify any discrepancies between the labor budget hours for a Control Account (CA) Work Authorization Document (WAD) in the DS08 WAD table and the corresponding cost in the DS03 cost table. 

The error is likely to be caused by a mismatch between the 'budget_labor_hours' field in the DS08 WAD table and the sum of 'BCWSi_hours' for the same Control Account in the DS03 cost table, where the Element of Cost (EOC) is 'Labor'. 

The 'budget_labor_hours' field in the DS08 WAD table should ideally match the sum of 'BCWSi_hours' in the DS03 cost table for the same Control Account. If these values do not match, it indicates a misalignment between the labor hours budgeted and the cost associated with those hours. 

This check is particularly relevant for entries where the 'WBS_ID_WP' field in the DS08 WAD table is empty, indicating that the Work Breakdown Structure (WBS) is at the Control Account level. 

In summary, this DIQ check ensures that the labor hours budgeted for a Control Account align with the cost associated with those hours, thereby maintaining the integrity and quality of the project management data.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the labor budget hours for a particular Control Account Work Authorization Document (CA WAD) align with the cost data. The test is checking if the budgeted labor hours are not equal to the sum of the Budgeted Cost of Work Scheduled (BCWS) hours where the Element of Cost (EOC) is labor, grouped by the Work Breakdown Structure ID for the Control Account (WBS_ID_CA).

The importance of this check is to ensure that the labor hours budgeted for a particular task or project align with the cost data. If there is a misalignment, it could indicate that there are errors in the budgeting or cost tracking process, which could lead to inaccurate cost projections and financial reporting. This could potentially cause problems during the analysis of the project's cost performance and efficiency.

The severity of this check is marked as a MAJOR. This means that while it may not prevent the data from being reviewed, it is likely to cause problems during analysis if not addressed. It is crucial to ensure that labor hours and costs are accurately tracked and aligned to maintain the integrity of the project's financial data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS08_WAD_AreLaborHoursMisalignedWithDS03CA] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with LaborCA as (
		SELECT WBS_ID_CA, SUM(BCWSi_hours) BCWSc
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND EOC = 'Labor'
		GROUP BY WBS_ID_CA
	)
	SELECT 
		W.*
	FROM
		DS08_WAD W INNER JOIN LaborCA C ON W.WBS_ID = C.WBS_ID_CA
										AND budget_labor_hours <> C.BCWSc
	WHERE
			upload_ID = @upload_ID  
		AND TRIM(ISNULL(W.WBS_ID_WP,'')) = ''
)
```
