## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS08 WAD |
| Severity    | MAJOR |
| Unique ID   | 9080607   |
| Summary     | Does the parent-child relationship for these CA & WP WBS IDs differ from what's in the WBS hierarchy? |
| Error message | WBS_ID / WBS_ID_WP combo <> DS01.WBS_ID / parent_WBS_ID combo. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "CA & WP Parent-Child Relationship Differs from WBS Hierarchy" is designed to verify the consistency of the parent-child relationships in the DS08 WAD table with the WBS hierarchy in the DS01 WBS table. 

The test is checking if the combination of WBS_ID and WBS_ID_WP in the DS08 WAD table matches the combination of WBS_ID and parent_WBS_ID in the DS01 WBS table. If there is a mismatch, it indicates that the parent-child relationship in the DS08 WAD table is not consistent with the WBS hierarchy in the DS01 WBS table.

The fields causing the issue are WBS_ID and WBS_ID_WP in the DS08 WAD table and WBS_ID and parent_WBS_ID in the DS01 WBS table. The expected values for these fields should be such that the combination of WBS_ID and WBS_ID_WP in the DS08 WAD table should match the combination of WBS_ID and parent_WBS_ID in the DS01 WBS table.

If the test fails, it could be due to incorrect data entry or changes in the WBS hierarchy that have not been reflected in the DS08 WAD table. It is recommended to review and correct the data in these fields to ensure data integrity and quality.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the parent-child relationship for Control Account (CA) and Work Package (WP) Work Breakdown Structure (WBS) IDs in the DS08 WAD table is consistent with the WBS hierarchy. The test is checking if the combination of WBS_ID and WBS_ID_WP in the DS08 WAD table is different from the combination of DS01.WBS_ID and parent_WBS_ID. 

The importance of this check is to maintain the integrity and accuracy of the hierarchical structure of the project. In project management, the WBS is a key tool that provides a structured view of the project and helps in organizing and defining the total scope of the project. Any discrepancies in the parent-child relationship can lead to confusion, misinterpretation of data, and potential errors in project planning and execution. 

The severity of this test is marked as a MAJOR, which implies that while it may not immediately prevent the data from being reviewed, inconsistencies in the WBS hierarchy are likely to cause problems during analysis. Therefore, it is recommended to address this issue to ensure accurate project management and reporting.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS08_WAD_DoesCAWPRelDifferFromDS01] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	SELECT 
		W.*
	FROM
		DS08_WAD W INNER JOIN DS01_WBS WBS  ON W.WBS_ID_WP = WBS.WBS_ID
											AND W.WBS_ID <> WBS.parent_WBS_ID
	WHERE
			W.upload_ID = @upload_ID
		AND WBS.upload_ID = @upload_ID
)
```
