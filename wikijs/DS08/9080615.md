## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS08 WAD |
| Severity    | MAJOR |
| Unique ID   | 9080615   |
| Summary     | Is the POP start for this Work Package WAD after the first recorded SPAE value in cost? |
| Error message | pop_start_date > min DS03.period_date where BCWS, BCWP, ACWP, or ETC <> 0 (by DS08.WBS_ID_WP & DS03.WBS_ID_WP). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "POP Start After Cost Start (WP)" is designed to ensure that the Period of Performance (POP) start date for a Work Package (WP) in the DS08 WAD table is not set after the first recorded SPAE value in cost. 

The error message "pop_start_date > min DS03.period_date where BCWS, BCWP, ACWP, or ETC <> 0 (by DS08.WBS_ID_WP & DS03.WBS_ID_WP)" indicates that the POP start date is later than the earliest period date in the DS03 cost table where any of the following fields are not zero: BCWSi_dollars, BCWSi_hours, BCWSi_FTEs, BCWPi_dollars, BCWPi_hours, BCWPi_FTEs, ACWPi_dollars, ACWPi_hours, ACWPi_FTEs, ETCi_dollars, ETCi_hours, or ETCi_FTEs. 

This discrepancy could be due to an error in data entry or a delay in updating the DS08 WAD table after changes to the DS03 cost table. The fields causing the issue are the POP_start_date in the DS08 WAD table and the period_date in the DS03 cost table. 

The expected values should be such that the POP start date for a Work Package is not later than the earliest period date where any of the cost fields are not zero. This is to ensure that the cost recording starts only after the commencement of the Work Package.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the Planned Order Production (POP) start date for a particular Work Package (WP) in the DS08 WAD table is not set after the first recorded SPAE value in cost. The SPAE value represents the cost of work scheduled, performed, actual, or estimated, and it is crucial that the POP start date aligns correctly with these cost values to ensure accurate project management and cost tracking.

The importance of this check lies in maintaining the integrity of the project timeline and cost management. If the POP start date is set after the first recorded cost, it could lead to inaccuracies in cost tracking and project scheduling, potentially causing delays and budget overruns. 

The severity of this test is marked as a MAJOR. This means that while it may not immediately prevent the data from being reviewed, it is likely to cause problems during analysis if not addressed. It is therefore recommended to correct this issue to ensure accurate and reliable project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS08_WAD_IsPOPStartAfterDS03StartWP] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with CostStart as (
		SELECT WBS_ID_WP WPWBS, MIN(period_date) Period
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND (
			BCWSi_dollars <> 0 OR BCWSi_hours <> 0 OR BCWSi_FTEs <> 0 OR
			BCWPi_dollars <> 0 OR BCWPi_hours <> 0 OR BCWPi_FTEs <> 0 OR
			ACWPi_dollars <> 0 OR ACWPi_hours <> 0 OR ACWPi_FTEs <> 0 OR
			ETCi_dollars <> 0 OR ETCi_hours <> 0 OR ETCi_FTEs <> 0
		)
		GROUP BY WBS_ID_WP
	)
	SELECT 
		W.*
	FROM 
		DS08_WAD W 	INNER JOIN LatestWPWADRev_Get(@upload_ID) R ON W.WBS_ID_WP = R.WBS_ID_WP 
																AND W.auth_PM_date = R.PMAuth
					INNER JOIN CostStart C 	ON W.WBS_ID_WP = C.WPWBS 
											AND POP_start_date > C.[Period]
	WHERE 
		upload_ID = @upload_ID
)
```
