## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS08 WAD |
| Severity    | MAJOR |
| Unique ID   | 9080397   |
| Summary     | Are the subcontract budget dollars for this WP/PP WAD misaligned with what is in cost? |
| Error message | budget_subcontract_dollars <> SUM(DS03.BCWSi_dollars) where EOC = subcontract (by WBS_ID_WP). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "WP Subcontract Dollars Misaligned With Cost" is designed to ensure that the subcontract budget dollars for each Work Package (WP) or Planning Package (PP) in the DS08 WAD table align with the corresponding cost data in the DS03 cost table.

The test is checking for discrepancies between the 'budget_subcontract_dollars' field in the DS08 WAD table and the sum of 'BCWSi_dollars' for each WP or PP in the DS03 cost table, where the 'EOC' (Element of Cost) is marked as 'Subcontract'. 

If the test fails, it indicates that there is a misalignment between the budgeted subcontract dollars and the actual cost data. This could be due to errors in data entry, incorrect allocation of costs, or changes in subcontract costs that have not been updated in the budget data.

To resolve this issue, you should review the budget and cost data for each WP or PP where a discrepancy has been identified. Ensure that the 'budget_subcontract_dollars' field in the DS08 WAD table accurately reflects the sum of 'BCWSi_dollars' in the DS03 cost table for each subcontracted WP or PP.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the subcontract budget dollars for a particular work package or planning package (WP/PP) within the DS08 WAD table align with the cost data in the DS03 table. The test is checking if the budgeted subcontract dollars are equal to the sum of the budgeted cost for work scheduled (BCWSi) dollars where the estimate at completion (EOC) is a subcontract, grouped by the work breakdown structure ID for the work package (WBS_ID_WP).

The importance of this check is to ensure that the budgeted costs for subcontracted work are accurately reflected in the overall project cost data. If these values are misaligned, it could lead to inaccurate cost projections, budget overruns, or misallocation of resources. This could potentially cause problems during the analysis of the project's cost performance and financial health.

The severity of this check is marked as a MAJOR. This means that while it may not prevent the data from being reviewed, it is likely to cause problems during analysis if not addressed. It is crucial to ensure that the budgeted subcontract dollars align with the cost data to maintain the accuracy and reliability of the project's financial data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS08_WAD_AreSubKDollarsMisalignedWithDS03WP] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with SubcontractWP as (
		SELECT WBS_ID_WP, SUM(BCWSi_dollars) BCWSc
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND EOC = 'Subcontract'
		GROUP BY WBS_ID_WP
	)
	SELECT 
		W.*
	FROM
		DS08_WAD W INNER JOIN SubcontractWP C 	ON W.WBS_ID_WP = C.WBS_ID_WP
												AND budget_subcontract_dollars <> C.BCWSc
	WHERE
		upload_ID = @upload_ID  
)
```
