## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS08 WAD |
| Severity    | MAJOR |
| Unique ID   | 9080411   |
| Summary     | Are the indirect budget dollars for this CA WAD misaligned with what is in cost? |
| Error message | budget_indirect_dollars <> SUM(DS03.BCWSi_dollars) where EOC = Indirect or is_indirect = Y (by WBS_ID_CA). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This Data Integrity and Quality (DIQ) check is designed to ensure that the indirect budget dollars recorded in the Work Authorization Document (DS08 WAD) are aligned with the summarized indirect cost dollars in the cost table (DS03 Cost). Specifically, it verifies that the budgeted indirect dollars for each Control Account (CA) within the Work Authorization Document match the sum of BCWSi (Budgeted Cost for Work Scheduled - indirect) dollars for that CA as recorded in the cost table, where the cost is categorized as indirect either by the End of Cost (EOC) indicator or the is_indirect flag.

The likely cause of an error flagged by this DIQ check is a discrepancy between the budgeted indirect dollars for a CA in the DS08 WAD table and the aggregated indirect cost dollars for the same CA in the DS03 Cost table. This discrepancy could arise from several issues, such as incorrect categorization of costs as indirect in the DS03 Cost table, errors in the budgeted indirect dollars entered in the DS08 WAD table, or missing entries in either table that should have been included in the calculation.

The fields causing the issue are the `budget_indirect_dollars` field in the DS08 WAD table, which should match the sum of `BCWSi_dollars` in the DS03 Cost table for costs flagged as indirect (either by having an EOC value of 'Indirect' or an is_indirect flag set to 'Y') for the same WBS_ID_CA (Work Breakdown Structure ID for Control Account).

Expected values for the `budget_indirect_dollars` in DS08 WAD should equal the aggregated sum of `BCWSi_dollars` from DS03 Cost for all entries related to the same CA and marked as indirect costs. If these values do not match, it indicates a potential misalignment in budgeting or cost categorization that needs to be addressed to ensure accurate project cost management and reporting.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This DIQ test is being performed on the 'DS08 WAD' table to ensure that the indirect budget dollars for a Control Account (CA) Work Authorization Document (WAD) are aligned with the sum of the Budgeted Cost for Work Scheduled (BCWS) in indirect dollars, as recorded in the 'DS03' table. The test checks if the 'budget_indirect_dollars' field in the 'DS08 WAD' table does not match the sum of 'BCWSi_dollars' (where 'EOC' equals 'Indirect' or 'is_indirect' equals 'Y') for each Work Breakdown Structure ID Control Account (WBS_ID_CA). The severity of this test is marked as a MAJOR, indicating that misalignment between the indirect budget dollars and the cost could likely cause problems during analysis.

The importance of this check lies in ensuring that the financial planning and tracking aspects of the project management are accurate and reliable. Indirect costs, such as overheads and administrative expenses, are crucial for the comprehensive budgeting and monitoring of a project. Misalignment between the budgeted indirect dollars and the actual indirect costs could lead to inaccurate project cost forecasts, potential budget overruns, and misinformed decision-making. By identifying and addressing these discrepancies, the project management team can maintain tighter control over the project's financial health, ensuring that indirect costs are accurately accounted for and managed throughout the project lifecycle.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS08_WAD_AreIndirectDollarsMisalignedWithDS03CA] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	with IndirectCA as (
		SELECT WBS_ID_CA, SUM(BCWSi_dollars) BCWSc
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND (EOC = 'Indirect' or is_indirect = 'Y')
		GROUP BY WBS_ID_CA
	)
	SELECT 
		W.*
	FROM
		DS08_WAD W INNER JOIN IndirectCA C 	ON W.WBS_ID = C.WBS_ID_CA
											AND budget_indirect_dollars <> C.BCWSc
	WHERE
			upload_ID = @upload_ID  
		AND TRIM(ISNULL(W.WBS_ID_WP,'')) = ''
)
```
