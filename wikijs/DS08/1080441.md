## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS08 WAD |
| Severity    | CRITICAL |
| Unique ID   | 1080441   |
| Summary     | Is this WAD a duplicate by WAD ID, WBS ID, WP WBS ID, & revision? |
| Error message | Count of WAD_ID, WBS_ID, WBS_ID_WP, & revision combo > 1. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check for the DS08 WAD table, titled 'Duplicate WAD', is designed to identify any instances where the combination of WAD ID, WBS ID, WP WBS ID, and revision appears more than once in the data. This combination of fields should be unique for each record, and any duplicates could indicate an error in data entry or processing.

The fields involved in this check are:

1. WAD ID: This is the identifier for the Work Authorization Document (WAD). Each WAD should have a unique ID.
2. WBS ID: This is the identifier for the Work Breakdown Structure (WBS). Each WBS should have a unique ID.
3. WP WBS ID: This is the identifier for the Work Package within the WBS. Each Work Package should have a unique ID within its WBS.
4. Revision: This field represents the revision number of the WAD. 

If the DIQ check identifies a record where the combination of these four fields is not unique, it could indicate that the same WAD has been entered into the system more than once, perhaps due to a misunderstanding or error in data entry. Alternatively, it could indicate a problem with the system's data processing or generation functions. 

To resolve this issue, you should review the identified records and determine whether they are indeed duplicates. If they are, you will need to decide which record to keep and which to remove, based on your organization's data management policies and the specific circumstances of the duplication. If the records are not duplicates, you may need to investigate further to identify the cause of the issue.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to check for duplicate entries in the 'DS08 WAD' table of the EVMS construction project management data. The test is looking for instances where the combination of 'WAD_ID', 'WBS_ID', 'WBS_ID_WP', and 'revision' fields are repeated more than once, which would indicate a duplicate entry.

The severity of this test is marked as 'CRITICAL', which is the highest level of severity. This means that if any duplicates are found, they must be resolved before the data can be reviewed. Duplicate entries can cause significant issues in data analysis, as they can skew results and lead to incorrect conclusions. 

The importance of this check is to ensure the accuracy and integrity of the data. In project management, accurate data is crucial for making informed decisions and tracking project progress. Therefore, maintaining data integrity by eliminating duplicate entries is a critical aspect of managing the EVMS construction project.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS08_WAD_PK] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with Dupes as (
		SELECT WAD_ID, WBS_ID, ISNULL(WBS_ID_WP,'') WPWBS, ISNULL(revision,'') revision
		FROM DS08_WAD
		WHERE upload_ID = @upload_ID
		GROUP BY WAD_ID, WBS_ID, ISNULL(WBS_ID_WP,''), ISNULL(revision,'')
		HAVING COUNT(*) > 1
	)
	SELECT 
		W.*
	FROM
		DS08_WAD W INNER JOIN Dupes D ON W.WBS_ID = D.WBS_ID
									 AND ISNULL(W.WBS_ID_WP,'') = D.WPWBS
									 AND W.revision = D.revision
									 AND W.wad_id = D.wad_id
	WHERE
		upload_ID = @upload_ID
)
```
