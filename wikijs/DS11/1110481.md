## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS11 Variance |
| Severity    | MINOR |
| Unique ID   | 1110481   |
| Summary     | Is there a root cause SV or CV narrative for this SLPP or PP VAR? |
| Error message | narrative_type = 200 or 400 & narrative_RC_SVi, narrative_RC_SVc, narrative_RC_CVi, or narrative_RC_CVc. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "SLPP or PP VAR With Root Cause Narrative" is performed on the DS11 Variance table. This check is designed to ensure that there is a root cause Schedule Variance (SV) or Cost Variance (CV) narrative for each Schedule or Performance Variance (SLPP or PP VAR).

The check is looking at the 'narrative_type' field and expects to find values of '200' or '400'. It then checks the 'narrative_RC_SVi', 'narrative_RC_CVi', 'narrative_RC_SVc', and 'narrative_RC_CVc' fields. At least one of these fields should contain a non-empty value, indicating that a root cause narrative exists.

If an error is flagged by this check, it is likely because a record in the DS11 Variance table has a 'narrative_type' of '200' or '400', but all of the root cause narrative fields ('narrative_RC_SVi', 'narrative_RC_CVi', 'narrative_RC_SVc', and 'narrative_RC_CVc') are empty. This would indicate that a root cause narrative is expected but has not been provided. To resolve this issue, a root cause narrative should be added to the appropriate field.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed on the 'DS11 Variance' table to check if there is a root cause Schedule Variance (SV) or Cost Variance (CV) narrative for the Schedule Performance Index (SLPP) or Performance Price Variance (PP VAR). The test is looking for specific narrative types (200 or 400) and checking for the presence of root cause narratives for SV or CV.

The importance of this check is to ensure that there is sufficient explanation or reasoning provided for any variances in schedule or cost. This is crucial for understanding the causes of these variances and for making informed decisions on how to address them. The severity level is set to 'MINOR', which means that while it may not prevent the data from being reviewed, the absence of these narratives could potentially lead to minor problems in the data analysis or indicate that the data does not fully adhere to best practices.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS11_VAR_DoesSLPPorPPVARHaveRCNarr] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	SELECT
		*
	FROM 
		DS11_variance
	WHERE 
			upload_ID = @upload_ID
		AND narrative_type IN ('200','400')
		AND (
			TRIM(ISNULL(narrative_RC_SVi,'')) <> '' 
			OR TRIM(ISNULL(narrative_RC_CVi,'')) <> ''
			OR TRIM(ISNULL(narrative_RC_SVc,'')) <> ''
			OR TRIM(ISNULL(narrative_RC_CVc,'')) <> ''
		)
)
```
