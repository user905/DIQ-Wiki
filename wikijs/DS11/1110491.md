## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS11 Variance |
| Severity    | MAJOR |
| Unique ID   | 1110491   |
| Summary     | Is this project-level VAR missing an overall narrative? |
| Error message | narrative_type < 200 & narrative_overall is missing or blank. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "Project-Level VAR Without Overall Narrative" is designed to identify any instances in the DS11 Variance table where a project-level Variance at Completion (VAR) is missing an overall narrative. 

The fields that are being checked in this DIQ are 'narrative_type' and 'narrative_overall'. The 'narrative_type' field should contain a value less than 200 to indicate that it is a project-level VAR. The 'narrative_overall' field should contain a narrative or description of the variance. If the 'narrative_type' field is less than 200 and the 'narrative_overall' field is missing or blank, this DIQ check will flag the record as an error.

The likely cause of this error is either an oversight during data entry, where the overall narrative was not provided for a project-level VAR, or a system error that resulted in the 'narrative_overall' field not being populated correctly. 

To resolve this issue, ensure that all project-level VARs in the DS11 Variance table have an associated overall narrative in the 'narrative_overall' field.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed on the 'DS11 Variance' table to check if the project-level Variance Analysis Report (VAR) is missing an overall narrative. The overall narrative is a crucial part of the VAR as it provides a comprehensive explanation of the project's performance, including any variances in the project's cost and schedule. 

The severity of this test is marked as 'MAJOR', which implies that the absence of an overall narrative is likely to cause problems during the analysis of the project's data. It may lead to misinterpretation or lack of understanding of the project's performance and variances. 

Therefore, this check is important to ensure that all necessary information is included in the VAR for a complete and accurate analysis of the project's performance. If the overall narrative is missing or blank, it should be added to maintain the integrity and quality of the project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS11_VAR_IsProjectLevelVARMissingNarr] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	SELECT
		*
	FROM 
		DS11_variance
	WHERE 
			upload_ID = @upload_ID
		AND CAST(ISNULL(narrative_type,'1000') as int) < 200 
		AND TRIM(ISNULL(narrative_overall,'')) = ''
)
```
