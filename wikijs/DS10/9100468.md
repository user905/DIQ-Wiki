## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS10 CC Log Detail |
| Severity    | MAJOR |
| Unique ID   | 9100468   |
| Summary     | Is this UB, MR, or CNT transaction being applied below the project level? |
| Error message | category = UB, MR, or CNT & DS01.level <> 1 (by WBS_ID). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "UB, MR, or CNT Transaction Below Project Level" is designed to ensure that certain types of transactions are not being applied below the project level in the DS10 CC Log Detail table. 

The types of transactions in question are those categorized as 'UB', 'MR', or 'CNT'. These transactions should only be applied at the project level, which is indicated by a level value of 1 in the DS01 WBS table. 

If the DIQ check identifies transactions of these categories that are associated with a level other than 1, it means that these transactions are being applied below the project level. This is likely due to an error in data entry or processing. 

To resolve this issue, review the transactions in the DS10 CC Log Detail table and ensure that 'UB', 'MR', and 'CNT' transactions are only associated with a level of 1 in the DS01 WBS table.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the Undistributed Budget (UB), Management Reserve (MR), or Contract (CNT) transactions are not being applied below the project level. In the context of EVMS (Earned Value Management System), these transactions should typically be applied at the project level. Applying them below the project level could lead to inaccuracies in budgeting and project management.

The importance of this check is to maintain the accuracy and integrity of the project's financial data. If these transactions are applied below the project level, it could lead to misrepresentation of the project's financial status, which could in turn lead to incorrect decision-making.

The severity of this check is marked as 'MAJOR', which means that while it may not immediately prevent the data from being reviewed, it is likely to cause problems during analysis. Therefore, it is recommended to address this issue to ensure accurate and reliable project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS10_CCLogDetails_IsNonDBTransactionBelowProjectLevel] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	SELECT 
		L.*
	FROM 
		DS10_CC_log_detail L INNER JOIN DS01_WBS W ON L.WBS_ID = W.WBS_ID
	WHERE 
		L.upload_ID = @upload_ID
	AND W.upload_ID = @upload_ID
	AND category IN ('UB','MR','CNT')
	AND W.[level] <> 1
)
```
