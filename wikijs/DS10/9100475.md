## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS10 CC Log Detail |
| Severity    | MAJOR |
| Unique ID   | 9100475   |
| Summary     | Is the POP start for this Control Account misaligned with what is in the WAD? |
| Error message | POP_start_date <> DS08.POP_start_date (select latest revision; check is on CA level). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "POP Start Misaligned with WAD (CA)" is designed to ensure that the Period of Performance (POP) start date for a given Control Account (CA) in the DS10 CC Log Detail table aligns with the corresponding POP start date in the DS08 WAD table. 

The test is performed at the Control Account (CA) level, and the results are grouped by the Work Breakdown Structure ID (WBS_ID). 

If an error is flagged by this DIQ check, it indicates that there is a discrepancy between the POP start dates in the DS10 and DS08 tables for a given Control Account. This could be due to a data entry error, a miscommunication between teams, or an update in one table that was not reflected in the other. 

To resolve this issue, you should ensure that the POP start dates for each Control Account in the DS10 CC Log Detail table match the corresponding dates in the DS08 WAD table. The expected value for the POP start date in the DS10 table should be the same as the latest revision of the POP start date in the DS08 table for the same Control Account.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the Period of Performance (POP) start date for a specific Control Account (CA) aligns with the date recorded in the Work Authorization Document (WAD). The test is comparing the POP start date in the 'DS10 CC Log Detail' table with the POP start date in the 'DS08' table. 

The importance of this check is to maintain consistency and accuracy in the project timeline. Misalignment of dates can lead to confusion, miscommunication, and potential delays in the project. It can also cause issues during data analysis, as the discrepancy might lead to incorrect interpretations or conclusions. 

The severity of this test is marked as 'MAJOR', which means that while it may not prevent the data from being reviewed, it is likely to cause problems during analysis if not addressed. Therefore, it is crucial to correct any discrepancies found during this test to ensure the integrity and quality of the project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS10_CCLogDetails_IsPOPStartMisalignedWithDS08CA] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	WITH WADStart AS (
		--Last CA WAD with POP Start
		SELECT 
			W.WBS_ID, POP_start_date
		FROM 
			DS08_WAD W INNER JOIN (
					SELECT WBS_ID, MAX(auth_PM_date) AS lastPMAuth
					FROM DS08_WAD
					WHERE upload_ID = @upload_ID
					GROUP BY WBS_ID
				) LastRev 	ON W.WBS_ID = LastRev.WBS_ID 
							AND W.auth_PM_date = LastRev.lastPMAuth
	)
	SELECT 
		L.*
	FROM 
		DS10_CC_log_detail L INNER JOIN WADStart W ON L.WBS_ID = W.WBS_ID
	WHERE 
		upload_ID = @upload_ID
	AND L.POP_start_date <> W.POP_start_date
)
```
