## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS07 IPMR Header |
| Severity    | MINOR |
| Unique ID   | 9070305   |
| Summary     | Is the PM EAC likely date earlier than the last recorded ETC plus estimated UB? |
| Error message | EAC_PM_likely < last DS03.period_date where ETCi > 0 (hours, dollars, or FTEs) + DS07.UB_EST_days. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "PM EAC Likely Date Misaligned with Cost Estimates" is designed to ensure that the Project Manager's Estimated At Completion (EAC) likely date is not earlier than the last recorded Estimate To Complete (ETC) plus the estimated Unbudgeted (UB) days. This check is performed on the DS07 IPMR Header table.

The error message "EAC_PM_likely < last DS03.period_date where ETCi > 0 (hours, dollars, or FTEs) + DS07.UB_EST_days" indicates that the EAC likely date set by the Project Manager is earlier than the sum of the last recorded ETC (in hours, dollars, or FTEs) and the estimated UB days. 

This discrepancy could be due to a variety of reasons such as incorrect data entry, changes in project timelines, or miscalculations in the ETC or UB estimates. 

The fields causing this issue are the EAC_PM_likely_date from the DS07 IPMR Header table, the period_date from the DS03_cost table where ETCi (in hours, dollars, or FTEs) is greater than zero, and the UB_EST_days from the DS07 IPMR Header table. 

The expected values for these fields should align such that the EAC likely date is not earlier than the last recorded ETC plus the estimated UB days. If the EAC likely date is earlier, it suggests that the project is expected to be completed before all estimated costs and unbudgeted days are accounted for, which may not be accurate. 

To resolve this issue, review and verify the data entries for these fields. Ensure that the EAC likely date is correctly calculated based on the last recorded ETC and the estimated UB days.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed on the 'DS07 IPMR Header' table to check if the Project Manager's (PM) Estimated At Completion (EAC) likely date is earlier than the last recorded Estimate To Complete (ETC) plus the estimated Undistributed Budget (UB). The test is designed to identify any potential misalignments between the PM's EAC likely date and the cost estimates.

The importance of this check lies in ensuring the accuracy and consistency of the project's financial data. If the PM's EAC likely date is earlier than the last recorded ETC plus the estimated UB, it could indicate that the project's cost estimates are not being accurately tracked or updated. This could lead to potential issues in project management, such as budget overruns or schedule delays.

The severity of this check is classified as an 'MINOR', which means it is less severe but still indicates that there might be minor problems or that the data doesn't follow all best practices. Therefore, while it may not immediately prevent the data from being reviewed, it is a potential issue that should be addressed to ensure the integrity and quality of the project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS07_IPMR_IsEACPMLikelyLtLastDS03ETCPlusUB] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with LastETCi as (
		SELECT MAX(period_date) LastETC
		FROM DS03_cost 
		WHERE upload_ID = @upload_ID AND (ETCi_dollars > 0 OR ETCi_FTEs > 0 OR ETCi_hours > 0)
	), WeekendFactor as (
		SELECT (ISNULL(UB_est_days,0) / 5) * 2 WkndF
		FROM DS07_IPMR_header 
		WHERE upload_ID = @upload_ID
	)
	SELECT 
		*
	FROM
		DS07_IPMR_header
	WHERE
			upload_ID = @upload_ID
		AND EAC_PM_likely_date < DATEADD(day, (SELECT TOP 1 WkndF FROM WeekendFactor), (SELECT TOP 1 LastETC FROM LastETCi))
)
```
