## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS07 IPMR Header |
| Severity    | MAJOR |
| Unique ID   | 9070361   |
| Summary     | Does TAB equal something other than CBB plus BAC Reprogramming? |
| Error message | TAB_dollars <> CBB_dollars + SUM(DS03.BAC_rpg). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "TAB Misaligned with BAC Reprogramming & CBB" is designed to ensure that the Total Allocated Budget (TAB) aligns with the sum of the Contract Budget Base (CBB) and the Budget at Completion Reprogramming (BAC_rpg) in the DS07 IPMR Header and DS03 Cost tables respectively.

If the DIQ check fails, it indicates that the TAB does not equal the sum of the CBB and BAC Reprogramming. This discrepancy could be due to an error in data entry or calculation in either the TAB, CBB, or BAC Reprogramming fields.

The expected value for the TAB should be the sum of the CBB and BAC Reprogramming. If the TAB does not match this sum, you will need to review and correct the data in these fields to ensure data integrity and quality.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed on the 'DS07 IPMR Header' table to ensure that the Total Allocated Budget (TAB) is correctly aligned with the Contract Budget Base (CBB) and the Budget at Completion (BAC) Reprogramming. The test checks if the TAB is equal to something other than the sum of CBB and BAC Reprogramming. 

The importance of this check is to ensure the accuracy and consistency of the budget data. If the TAB does not align with the sum of CBB and BAC Reprogramming, it could lead to incorrect financial reporting and budgeting decisions. This could potentially cause problems during the analysis of the project's financial data, hence the severity level is set as 'MAJOR'. It is crucial to address this issue to maintain the integrity and quality of the project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS07_IPMR_IsTABNEqToBACRpgPlusCBB] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	SELECT 
		*
	FROM
		DS07_IPMR_header
	WHERE
			upload_ID = @upload_ID
		AND ISNULL(TAB_dollars,0) <> ISNULL(CBB_dollars,0) + (SELECT SUM(ISNULL(BAC_rpg, 0)) FROM DS03_cost WHERE upload_ID = @upload_ID) 
)
```
