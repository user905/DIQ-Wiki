## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS07 IPMR Header |
| Severity    | MINOR |
| Unique ID   | 9070307   |
| Summary     | Is the PM EAC Likely date later than the Contract Completion milestone? |
| Error message | EAC_PM_Likely_date > minimum DS04.EF_date where milestone_level = 180 (FC only). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "PM EAC Likely Date After Contract Completion" is designed to ensure that the Project Manager's Estimated At Completion (EAC) Likely date is not later than the Contract Completion milestone. This check is performed on the DS07 IPMR Header table.

The error is likely to occur when the EAC_PM_Likely_date field in the DS07 IPMR Header table is greater than the minimum EF_date in the DS04 Schedule table where the milestone_level is 180 and the schedule_type is 'FC'. 

In simpler terms, this means that the estimated date at which the project manager expects to complete the project (EAC_PM_Likely_date) is later than the earliest date at which the contract is expected to be completed (minimum EF_date). This discrepancy could be due to incorrect data entry or a change in the project timeline that has not been reflected in the data.

The expected values for the EAC_PM_Likely_date field should be a date that is on or before the minimum EF_date in the DS04 Schedule table for the corresponding contract. If the EAC_PM_Likely_date is later than the minimum EF_date, it indicates a potential issue with the project timeline or data accuracy that needs to be addressed.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed on the 'DS07 IPMR Header' table to check if the Project Manager's (PM) Estimated At Completion (EAC) Likely date is later than the Contract Completion milestone. The test is checking if the EAC_PM_Likely_date is greater than the minimum DS04.EF_date where the milestone_level equals 180 (Final Completion only). 

The importance of this check is to ensure that the project's estimated completion date is not set after the contract's completion date. If the project's estimated completion date is later than the contract's completion date, it could indicate potential delays in the project, which could lead to additional costs and resources. 

The severity of this test is marked as an MINOR. This means that while it's not a critical issue that would prevent the data from being reviewed, it's still a potential problem that could cause minor issues during data analysis. It's also a sign that the data may not be following best practices for project management. Therefore, it's important to address this alert to ensure accurate and efficient project management and data analysis.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS07_IPMR_IsEACPMLikelyGtContractCompletion] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with ContComp as (
		SELECT MIN(EF_date) MinEF
		FROM DS04_schedule
		WHERE upload_ID = @upload_ID AND milestone_level = 180 AND schedule_type = 'FC'
	)
	SELECT 
		*
	FROM
		DS07_IPMR_header
	WHERE
			upload_ID = @upload_ID
		AND EAC_PM_likely_date > (SELECT TOP 1 MinEF FROM ContComp)
)
```
