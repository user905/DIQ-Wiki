## Basic Information

| Key           | Value                                                               |
| ------------- | ------------------------------------------------------------------- |
| Table         | DS19 Sched CAL Std                                                  |
| Severity      | ERROR                                                               |
| Unique ID     | 1190593                                                             |
| Summary       | Is this calendar name duplicated in the dataset (by subproject_ID)? |
| Error message | Count calendar_name > 1 (by subproject_id).                         |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
> {.is-warning}

The Data Integrity and Quality (DIQ) check for the DS19 Sched CAL Std table, titled "Duplicate Calendar Name", is designed to identify any instances where the same calendar name is used more than once within the dataset.

The error message "Count calendar_name > 1" indicates that the DIQ check has found one or more calendar names that are duplicated in the dataset. This is likely caused by an error in data entry, where the same calendar name has been entered for different calendar entries.

The field causing this issue is the 'calendar_name' field. Each entry in this field should be unique, representing a distinct calendar. If the same name is used for more than one calendar, it can cause confusion and errors in data analysis.

To resolve this issue, review the data in the 'calendar_name' field of the DS19 Sched CAL Std table. Ensure that each calendar has a unique name. If any duplicates are found, they should be renamed or removed to maintain data integrity and quality.

## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
> {.is-warning}

This test is being performed to ensure that there are no duplicate calendar names in the 'DS19 Sched CAL Std' table of the dataset. The presence of duplicate calendar names could lead to confusion and errors in data analysis and interpretation. This check is of utmost importance as it has been marked with a severity of 'ERROR', indicating that this issue must be resolved before the data can be reviewed. Ensuring unique calendar names is crucial for maintaining data integrity and quality, as it allows for accurate tracking and scheduling of project tasks and activities.

## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS19_Sched_CAL_Std_PK] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	with Dupes as (
		SELECT calendar_name, ISNULL(subproject_ID, '') SubP
		FROM DS19_schedule_calendar_std
		WHERE upload_ID = @upload_ID
		GROUP BY calendar_name, ISNULL(subproject_ID, '')
		HAVING COUNT(*) > 1
	)
	SELECT std.*
	FROM DS19_schedule_calendar_std std INNER JOIN Dupes d ON std.calendar_name = d.calendar_name AND ISNULL(std.subproject_ID,'') = d.SubP
	WHERE upload_ID = @upload_ID
)
```

### Changelog

| Date       | Description of Changes                                                                   |
| ---------- | ---------------------------------------------------------------------------------------- |
| 2024-04-30 | Logic adjusted to account for 'subproject_id' field, as well as for minor optimizations. |
