## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS17 WBS EU |
| Severity    | MINOR |
| Unique ID   | 9170576   |
| Summary     | Are the EU maximum dollars less than the cost DB for this WBS_ID / EOC combo? |
| Error message | EU_max_dollars < DS03.DB by WBS_ID_WP & EOC. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "EU Max Dollars Less Than DB" is performed on the DS17 WBS EU table. This check is designed to ensure that the maximum dollars allocated to each Work Breakdown Structure (WBS) element and Element of Cost (EOC) combination in the DS17 WBS EU table are not less than the cost DB from the DS03 cost table for the same WBS and EOC combination.

If this DIQ check fails, it indicates that the maximum dollars allocated to a specific WBS and EOC combination in the DS17 WBS EU table (EU_max_dollars) is less than the corresponding cost DB in the DS03 cost table. This discrepancy could be due to an error in data entry or a miscalculation in the cost DB.

To resolve this issue, you should review the data for the WBS and EOC combination in question. Ensure that the maximum dollars allocated in the DS17 WBS EU table (EU_max_dollars) is not less than the cost DB from the DS03 cost table. If necessary, adjust the values to ensure data integrity and quality.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the maximum dollars allocated for each work breakdown structure (WBS) element under execution (EU) is not exceeding the cost database (DB) value for the same WBS/EOC (End of Contract) combination. This is important because it helps maintain financial control and prevents overspending on specific tasks or elements of the project.

The severity of this check is marked as an MINOR, which means it's not a critical issue that would prevent the data from being reviewed. However, it's still important to address because it could lead to minor problems in the data or indicate that the data isn't following all best practices. For instance, if the EU maximum dollars consistently exceed the DB value, it could indicate a problem with budgeting or cost control processes.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS17_WBS_EU_IsEUMaxLtDS03DB] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with CostWPDB as (
		SELECT WBS_ID_WP, EOC, SUM(BCWSi_Dollars) DB
		FROM DS03_cost
		WHERE upload_ID = @upload_ID
		GROUP BY WBS_ID_WP, EOC
	)
	SELECT 
		E.*
	FROM 
		DS17_WBS_EU E INNER JOIN CostWPDB C ON E.WBS_ID = C.WBS_ID_WP AND E.EOC = C.EOC
	WHERE 
			upload_ID = @upload_ID
		AND E.EU_max_dollars < C.DB
)
```
