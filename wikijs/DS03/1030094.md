## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS03 Cost |
| Severity    | WARNING |
| Unique ID   | 1030094   |
| Summary     | Is this WP or PP lacking sufficient Indirect? (Minimally 10% of the total budget by period) |
| Error message | BCWSi_dollars/hours/FTEs for this WP or PP makes up less than 10% of total budget for this period (on Dollars, Hours, or FTEs). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This Data Integrity and Quality (DIQ) check, titled "Insufficient Indirect," is designed to ensure that each Work Package (WP) or Planning Package (PP) within the DS03 Cost table has a sufficient indirect cost allocation. Specifically, the check verifies that the indirect costs (either in dollars, hours, or Full-Time Equivalents (FTEs)) constitute at least 10% of the total budget for the given period for each WP or PP.

The DIQ test identifies instances where the Budgeted Cost for Work Scheduled indirect (BCWSi) for a WP or PP falls below this 10% threshold. This could indicate a potential issue in the budgeting process or an error in data entry, where indirect costs have been underallocated or possibly misclassified.

The fields involved in this check include:
- `WBS_ID_CA` and `WBS_ID_WP` for identifying the Control Account (CA) and Work Package (WP) or Planning Package (PP), respectively.
- `period_date` for identifying the specific time period being evaluated.
- `BCWSi_Dollars` for evaluating the budgeted indirect costs against the total budgeted costs.

A likely cause of the error flagged by this DIQ test could be an incorrect entry in the `BCWSi_Dollars` field, where indirect costs have been underestimated or not properly accounted for. Alternatively, it could result from a misclassification of costs, where costs that should have been marked as indirect (`EOC = 'Indirect'` or `is_indirect = 'Y'`) were not correctly identified as such.

To resolve issues flagged by this test, users should review the budget entries for the affected WP or PP, ensuring that indirect costs are correctly classified and meet the minimum required percentage of the total budget. This may involve adjusting the budgeted indirect costs or reclassifying certain costs as indirect to accurately reflect the project's financial structure.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The "Insufficient Indirect" test is being performed on the "DS03 Cost" table to ensure that each Work Package (WP) or Planning Package (PP) has allocated a sufficient amount of indirect costs, which should minimally constitute 10% of the total budget for any given period. This test is crucial because indirect costs cover necessary expenditures that are not directly tied to a specific project task but are essential for the overall project execution, such as administrative expenses, facilities costs, and utilities. These costs support the project infrastructure and are critical for a realistic and comprehensive budgeting process.

The importance of this check lies in its ability to highlight instances where the budget allocation for indirect costs falls below the minimum threshold of 10% of the total budget for a period, measured in dollars, hours, or Full-Time Equivalents (FTEs). This situation is flagged with a severity of "WARNING," indicating that while the project data can still be reviewed, the identified issue is likely to cause problems during analysis or project execution. It suggests that the project may not be adequately accounting for all necessary indirect expenses, potentially leading to budget shortfalls or misallocations that could affect project health and success.

By grouping the test results by Work Breakdown Structure (WBS) Identifier for Control Account (CA), WBS Identifier for Work Package (WP), and the period date, stakeholders can easily identify where the budgeting process may need adjustments to ensure that all indirect costs are properly accounted for, thereby maintaining the integrity and quality of the project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS03_Cost_IsIndirectInsufficient] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	with TotalS AS (
		SELECT WBS_ID_CA CAID, WBS_ID_WP WPID, period_date Period, NULLIF(SUM(BCWSi_Dollars),0) D
		FROM DS03_cost
		WHERE upload_ID = @upload_ID
		GROUP BY WBS_ID_CA, WBS_ID_WP, period_date
	), Indirects AS (
		SELECT WBS_ID_CA CAID, WBS_ID_WP WPID, period_date Period, SUM(BCWSi_Dollars) D
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND (EOC = 'Indirect' or is_indirect = 'Y')
		GROUP BY WBS_ID_CA, WBS_ID_WP, period_date
	), Flags AS (
		SELECT T.CAID, T.WPID, T.Period
		FROM TotalS T INNER JOIN Indirects I ON T.CAID = I.CAID 
											AND T.WPID = I.WPID
											AND T.[Period] = I.[Period]
		WHERE ABS(I.D / T.D) < .1 
	)
	SELECT 
		C.* 
	FROM 
		DS03_Cost C INNER JOIN Flags F ON C.WBS_ID_CA = F.CAID
										AND C.WBS_ID_WP = F.WPID
										AND C.period_date = F.period
	WHERE
			upload_ID = @upload_ID
)
```
