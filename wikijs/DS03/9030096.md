## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS03 Cost |
| Severity    | MAJOR |
| Unique ID   | 9030096   |
| Summary     | Is this SLPP or PP mistyped in DS01 (WBS)? |
| Error message | EVT = K but DS01 (WBS) type is not SLPP or PP. (Note: This flag also appears if DS01 type = PP but no WP ID is missing and if type = SLPP but a WP ID was found.) |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "SLPP or PP Type Mismatch with DS01 (WBS)" is designed to identify potential discrepancies in the DS03 Cost table. Specifically, it checks for mismatches between the EVT field in the DS03 Cost table and the type field in the DS01 (WBS) table.

The error message "EVT = K but DS01 (WBS) type is not SLPP or PP" indicates that there is a mismatch between the EVT field in the DS03 Cost table and the type field in the DS01 (WBS) table. This mismatch could be due to a typographical error or incorrect data entry.

The DIQ check also flags an error if the type field in the DS01 (WBS) table is 'PP' but the WP ID is missing in the DS03 Cost table. Conversely, if the type field in the DS01 (WBS) table is 'SLPP' but a WP ID is found in the DS03 Cost table, this will also trigger an error.

To resolve these issues, ensure that the EVT field in the DS03 Cost table matches the type field in the DS01 (WBS) table. If the type field in the DS01 (WBS) table is 'PP', make sure a corresponding WP ID is present in the DS03 Cost table. If the type field in the DS01 (WBS) table is 'SLPP', ensure that no WP ID is found in the DS03 Cost table.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the data in the 'DS03 Cost' table is consistent with the data in the 'DS01 (WBS)' table, specifically in terms of the SLPP or PP type. The test is checking if there is a mismatch between the EVT value and the DS01 type. For instance, if the EVT is marked as 'K' but the DS01 type is not SLPP or PP, it raises a warning. Similarly, if the DS01 type is PP but no WP ID is found, or if the type is SLPP but a WP ID is found, it also triggers a warning.

The importance of this check lies in maintaining data integrity and ensuring accurate data representation. Inconsistent data can lead to incorrect analysis and decision-making. The severity level of this check is 'MAJOR', which means that while it may not prevent the data from being reviewed, it is likely to cause problems during analysis if not addressed. Therefore, it is crucial to correct these mismatches to ensure the quality and reliability of the project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS03_Cost_IsSLPPOrPPMistypedInDS01] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with ToTest AS (
		SELECT WBS_ID, type 
		FROM DS01_WBS 
		WHERE upload_ID = @upload_ID
	)
	SELECT 
		* 
	FROM 
		DS03_Cost
	WHERE 
			upload_ID = @upload_ID
		AND EVT = 'K'
		AND (
			(ISNULL(WBS_ID_WP,'') = '' AND WBS_ID_CA IN (Select WBS_ID FROM ToTest WHERE type <> 'SLPP')) OR
			(ISNULL(WBS_ID_WP,'') <> '' AND WBS_ID_WP IN (SELECT WBS_ID FROM ToTest WHERE type <> 'PP'))
		)
)
```
