## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS03 Cost |
| Severity    | WARNING |
| Unique ID   | 1030112   |
| Summary     | Does this WP/PP mingle Subcontract with other EOC types (excluding Indirect)? |
| Error message | EOC = Subcontract & Material, ODC, or Labor by WBS_ID_WP. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This Data Integrity and Quality (DIQ) check is designed to ensure that within the DS03 Cost table, Work Breakdown Structure (WBS) elements or Work Packages (WP)/Planning Packages (PP) do not improperly combine Subcontract costs with other types of Elements of Cost (EOC), excluding Indirect costs. Specifically, it verifies that Subcontract costs are not mixed with Material, Other Direct Costs (ODC), or Labor costs under the same WBS ID for Work Packages or Planning Packages.

The error flagged by this DIQ check indicates that there are instances where a Subcontract EOC is found alongside other non-Indirect EOC types (Material, ODC, or Labor) within the same WBS ID for Work Packages or Planning Packages. This could potentially lead to inaccuracies in cost reporting and allocation, as Subcontract costs are typically managed and reported differently from other direct costs like Material, ODC, or Labor.

The likely cause of this error could be incorrect data entry or misclassification of costs at the WBS element or Work Package/Planning Package level. To resolve this issue, review the affected WBS IDs to ensure that Subcontract costs are correctly classified and segregated from other EOC types. Expected values for the EOC field should be consistent within a WBS ID for Work Packages or Planning Packages, ensuring that Subcontract costs are not mixed with Material, ODC, or Labor costs unless they are accurately reflecting the project's cost structure and reporting requirements.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This DIQ test is being performed on the 'DS03 Cost' table to ensure that work packages (WP) or planning packages (PP) do not improperly combine subcontract costs with other types of Elements of Cost (EOC), such as Material, Other Direct Costs (ODC), or Labor, excluding indirect costs, within the same Work Breakdown Structure ID for Work Packages (WBS_ID_WP). The purpose of this test is to maintain the integrity and clarity of cost reporting and allocation within the project management data. By checking for the mingling of subcontract costs with other EOC types, the test aims to prevent potential misinterpretation or misallocation of costs, which could lead to inaccurate project cost tracking, reporting, and analysis. The severity level of 'WARNING' indicates that while this issue may not immediately invalidate the data, it is likely to cause problems during cost analysis or financial auditing processes, suggesting that corrective action should be taken to ensure accurate and clear financial reporting. This check is important because it helps uphold the principles of clear and accurate financial management within the project, ensuring that each type of cost is properly categorized and reported, which is crucial for effective project management and financial oversight.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS03_Cost_IsSubKComingledWithNonIndirectEOCs] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	with NonSubK AS (
		SELECT WBS_ID_WP WPID
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND EOC NOT IN ('Subcontract','Indirect') AND TRIM(ISNULL(WBS_ID_WP,'')) <> ''
		GROUP BY WBS_ID_WP
	)
	SELECT C.* 
	FROM DS03_Cost C LEFT OUTER JOIN NonSubK N ON C.WBS_ID_WP = N.WPID
	WHERE	upload_ID = @upload_ID AND EOC = 'Subcontract' AND N.WPID IS NOT NULL
)
```
