## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS03 Cost |
| Severity    | MAJOR |
| Unique ID   | 9030105   |
| Summary     | Is the parent ID of this WP or PP misaligned with what is in DS01 (WBS)? |
| Error message | The parent ID for this WP or PP does not align with the parent ID found in DS01 (WBS). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "WP or PP Parent Mismatched with DS01 (WBS) Parent" is designed to identify any discrepancies between the parent ID of a Work Package (WP) or Planning Package (PP) in the DS03 Cost table and the corresponding parent ID in the DS01 (WBS) table. 

The error message "The parent ID for this WP or PP does not align with the parent ID found in DS01 (WBS)" indicates that there is a mismatch between these two fields. This discrepancy could be due to a data entry error, a change in the project structure that was not properly updated in both tables, or a problem with the data import process.

The fields causing the issue are the 'WBS_ID_WP' field in the DS03 Cost table and the 'parent_WBS_ID' field in the DS01 (WBS) table. The expected value for the 'WBS_ID_WP' field in the DS03 Cost table should match the 'parent_WBS_ID' field in the DS01 (WBS) table for the same work package or planning package.

To resolve this issue, you should review the data in both tables and correct any discrepancies. This may involve updating the parent ID in one or both tables, or investigating the source of the data to identify and correct the root cause of the mismatch.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the parent ID of a Work Package (WP) or Planning Package (PP) aligns with the parent ID found in DS01 (Work Breakdown Structure or WBS). The test is crucial because it checks for consistency between the WP or PP and the WBS, which is essential for accurate project management and tracking. 

The severity of this test is marked as a MAJOR, which means that if the parent IDs are mismatched, it could cause problems during data analysis. This could lead to incorrect conclusions or decisions based on the data, potentially impacting the project's success. Therefore, it's important to address this issue to ensure the integrity and quality of the project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS03_Cost_IsWPOrPPParentMismatchedWithDS01Parent] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
    
	with WBSDict as (
		SELECT WBS_ID Child, parent_WBS_ID Parent
		FROM DS01_WBS 
		WHERE upload_ID = @upload_ID
	)
	SELECT 
		C.* 
	FROM 
		DS03_Cost C INNER JOIN WBSdict W ON C.WBS_ID_WP = W.Child
										AND C.WBS_ID_CA <> W.Parent
	WHERE 
			upload_ID = @upload_ID
		AND TRIM(ISNULL(WBS_ID_WP,'')) <> ''
)
```
