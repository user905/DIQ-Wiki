## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS03 Cost |
| Severity    | WARNING |
| Unique ID   | 1030098   |
| Summary     | Does this CA, SLPP, PP, or WP have only Indirect EOCs? |
| Error message | CA, SLPP, PP, or WP with only Indirect. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This Data Integrity and Quality (DIQ) check is designed to ensure that within the DS03 Cost table, any Control Account (CA), Summary Level Planning Package (SLPP), Planning Package (PP), or Work Package (WP) that is marked as having only 'Indirect' Elements of Cost (EOCs) truly does not contain any other types of EOCs. The purpose of this check is to maintain the integrity of cost management by verifying that indirect costs are not being improperly combined with direct costs within the same CA, SLPP, PP, or WP.

An error flagged by this DIQ test indicates that there is a CA, SLPP, PP, or WP which is supposed to contain only indirect costs (as indicated by the EOC being 'Indirect' or the is_indirect flag being 'Y'), but other types of EOCs are either absent or incorrectly marked. This could be due to several reasons:

1. **Incorrect EOC Classification**: The EOC for certain costs may have been incorrectly classified. For instance, a cost that is actually direct might have been mistakenly labeled as indirect, or vice versa.

2. **Data Entry Errors**: There might have been errors in data entry, leading to the misclassification of the EOC type for certain entries within a CA, SLPP, PP, or WP.

3. **Misunderstanding of Definitions**: The personnel entering the data might not have a clear understanding of what constitutes an indirect cost versus a direct cost, leading to incorrect assignments.

The fields causing the issue are primarily the `EOC` (Element of Cost) and `is_indirect`. The expected values for a CA, SLPP, PP, or WP that truly contains only indirect costs are that all entries related to it should have their EOC marked as 'Indirect' or the `is_indirect` flag set to 'Y', without any other types of EOCs present.

To resolve errors flagged by this DIQ test, review the EOC classifications for accuracy in the affected CA, SLPP, PP, or WP. Ensure that all costs are correctly classified as either direct or indirect according to the project's cost management guidelines, and correct any misclassifications or data entry errors found.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This DIQ test is performed on the 'DS03 Cost' table to ensure that Control Accounts (CA), Summary Level Planning Packages (SLPP), Planning Packages (PP), or Work Packages (WP) contain only Indirect Elements of Cost (EOCs). The purpose of this test is to verify that indirect costs are not mixed with other types of costs within these entities. The importance of this check lies in maintaining the accuracy and clarity of cost reporting and analysis. By ensuring that indirect costs are properly segregated, it facilitates more accurate cost tracking, allocation, and analysis, which is crucial for effective project management and financial control. The severity level of 'WARNING' indicates that if indirect costs are mingled with other EOCs, it could likely cause problems during cost analysis or financial reporting, potentially leading to inaccurate project cost assessments or misallocations of funds.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS03_Cost_IsIndirectWorkMissingOtherEOCTypes] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	with NonIndirect AS (
		SELECT WBS_ID_CA CAID, ISNULL(WBS_ID_WP,'') WPID
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND EOC <> 'Indirect' AND ISNULL(is_indirect,'') <> 'Y'
		GROUP BY WBS_ID_CA, ISNULL(WBS_ID_WP,'')
	)
	SELECT C.* 
	FROM DS03_Cost C LEFT OUTER JOIN NonIndirect N 	ON C.WBS_ID_CA = N.CAID AND ISNULL(C.WBS_ID_WP,'') = N.WPID
	WHERE	upload_ID = @upload_ID
		AND (EOC = 'Indirect' OR is_indirect = 'Y')
		AND N.CAID IS NULL
)
```
