> Note: DIQ has been deleted.
> {.is-danger}

## Basic Information

| Key           | Value                                                                                                                   |
| ------------- | ----------------------------------------------------------------------------------------------------------------------- |
| Table         | DS06 Resources                                                                                                          |
| Severity      | MAJOR                                                                                                                 |
| Unique ID     | 1060240                                                                                                                 |
| Summary       | Is Overhead EOC used for some tasks but not all?                                                                        |
| Error message | Task lacking overhead EOC despite overhead use elsewhere (if overhead is used on tasks, it must be used for all tasks). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
> {.is-warning}

The Data Integrity and Quality (DIQ) check titled "Uneven Use of Overhead" is designed to ensure consistency in the application of overhead costs across all tasks within the DS06 Resources table.

The test identifies instances where overhead End of Contract (EOC) costs are applied to some tasks but not all within the same schedule type. This inconsistency can lead to inaccurate cost calculations and projections.

The fields involved in this check are 'task_ID', 'schedule_type', and 'EOC'. The 'task_ID' field identifies the specific task, the 'schedule_type' field indicates the type of schedule (either 'FC' or 'BL'), and the 'EOC' field specifies whether overhead costs are applied to the task.

If overhead costs are used in any task within a specific schedule type, they should be applied to all tasks within that same schedule type. If the test identifies a task where overhead costs are not applied, despite being used elsewhere in the same schedule type, an error will be flagged.

To resolve this issue, review the tasks within the flagged schedule type and ensure that overhead costs are consistently applied across all tasks. If overhead costs are not applicable to a task, they should not be applied to any task within the same schedule type.

## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
> {.is-warning}

This test is being performed to ensure consistency in the use of overhead EOC (Estimate of Completion) across all tasks in the DS06 Resources table. The test is checking if overhead EOC is used for some tasks but not all, which could lead to inconsistencies and inaccuracies in the project's cost estimation and management.

The importance of this check lies in maintaining the integrity and quality of the project management data. Inconsistent use of overhead EOC could lead to skewed data, which in turn could affect the accuracy of project cost estimations, resource allocation, and overall project management. This could potentially lead to cost overruns, misallocation of resources, and other project management issues.

The severity of this check is marked as a MAJOR. This means that while it may not immediately prevent the data from being reviewed, it is likely to cause problems during analysis if not addressed. Therefore, it is crucial to ensure that overhead EOC is consistently used across all tasks to maintain the accuracy and reliability of the project management data.

## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS06_Res_IsOverheadUsedUnevenly] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(

	with Ovhd as (
		SELECT task_ID, schedule_type
		FROM DS06_schedule_resources
		WHERE upload_ID = @upload_ID AND EOC = 'Overhead'
	)
	SELECT
		*
	FROM
		DS06_schedule_resources
	WHERE
			upload_id = @upload_ID
		AND (
				schedule_type = 'FC' AND task_ID NOT IN (SELECT task_ID from Ovhd WHERE schedule_type = 'FC') OR
				schedule_type = 'BL' AND task_ID NOT IN (SELECT task_ID from Ovhd WHERE schedule_type = 'BL')
		)
)
```
