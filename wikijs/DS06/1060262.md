## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS06 Resources |
| Severity    | WARNING |
| Unique ID   | 1060262   |
| Summary     | Is Indirect EOC used for some tasks but not all? |
| Error message | Task lacking Indirect EOC despite Indirect use elsewhere (if Indirect is used on tasks, it must be used for all tasks). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This Data Integrity and Quality (DIQ) check is designed to ensure consistent application of Indirect End of Cost (EOC) across all tasks within the DS06 Resources table. The purpose of this check is to identify any tasks that do not have Indirect EOC assigned, despite the use of Indirect EOC on other tasks within the same project or subproject. This is important because inconsistent application of Indirect EOC can lead to inaccuracies in project cost management and reporting.

The error highlighted by this DIQ check indicates that there are tasks within the project that lack an Indirect EOC designation, even though Indirect EOC has been applied to other tasks. This inconsistency can occur for a variety of reasons, such as oversight during data entry, misunderstanding of project cost allocation practices, or changes in project scope or budgeting that have not been uniformly applied across all tasks.

The fields involved in this check are `task_ID`, `schedule_type`, and `subproject_ID` from the DS06 Resources table, with a specific focus on the `EOC` (End of Cost) field. The expected behavior is that if any task within a given schedule type or subproject is assigned an Indirect EOC, then all tasks within that schedule type or subproject should also have an Indirect EOC assigned.

To resolve issues identified by this DIQ check, users should review the tasks flagged by the check to determine why the Indirect EOC was not applied. This may involve consulting project documentation, budgeting guidelines, or discussions with project management to ensure that the application of Indirect EOC is consistent with project policies and practices. Once the cause of the inconsistency is identified, appropriate corrections should be made to the data to ensure that all tasks are correctly classified with respect to Indirect EOC.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This DIQ test, titled "Uneven Use of Indirect," is performed on the "DS06 Resources" table to ensure consistency in the application of Indirect End of Cost (EOC) across all tasks within a project. The test is flagged with a severity of WARNING, indicating that while the issue does not immediately invalidate the data, it is likely to cause problems during analysis if not addressed.

The importance of this check lies in maintaining uniformity in cost allocation and reporting practices across the project. Indirect costs, such as administrative expenses, utilities, and security, are essential for a comprehensive understanding of the total project cost. When indirect costs are applied to some tasks but not others without a clear rationale, it can lead to inaccurate cost assessments, budgeting errors, and challenges in project cost performance analysis.

By ensuring that if indirect costs are used, they are consistently applied across all tasks, this test helps in achieving a more accurate and fair representation of the project's financial status. It aids in preventing potential budgeting and financial reporting discrepancies, thereby supporting better project management and decision-making processes.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS06_Res_IsIndirectUsedUnevenly] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	with Ovhd as (
		SELECT task_ID, schedule_type, TRIM(ISNULL(subproject_ID,'')) SubP
		FROM DS06_schedule_resources 
		WHERE upload_ID = @upload_ID AND EOC = 'Indirect'
	)
	SELECT R.*
	FROM DS06_schedule_resources R LEFT OUTER JOIN Ovhd O ON R.task_ID = O.task_ID AND R.schedule_type = O.schedule_type AND TRIM(ISNULL(R.subproject_ID,'')) = O.SubP
	WHERE upload_id = @upload_ID
        AND EXISTS (SELECT 1 FROM Ovhd)
		AND O.task_ID IS NULL
		AND R.EOC <> 'Indirect'
)
```
