## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS13 Subcontract |
| Severity    | CRITICAL |
| Unique ID   | 1130538   |
| Summary     | Is this subcontract task duplicated by subcontract ID, subcontract PO ID, & task ID? |
| Error message | Count of subK_id, subK_task_id, & task_ID combo > 1. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check for the DS13 Subcontract table, titled 'Duplicate Subcontract Task', is designed to identify any instances where a subcontract task may be duplicated. This duplication is determined by checking if the combination of the subcontract ID (subK_id), subcontract PO ID (subK_task_id), and task ID (task_ID) appears more than once in the data.

If the DIQ check returns a positive result, it indicates that there are duplicate entries in the DS13 Subcontract table. This could be due to a data entry error, where the same subcontract task has been entered more than once, or a system error that has duplicated entries.

The fields causing the issue are the subcontract ID (subK_id), subcontract PO ID (subK_task_id), and task ID (task_ID). The expected values for these fields should be unique combinations for each subcontract task. If the same combination appears more than once, it is flagged as a duplicate by the DIQ check.

To resolve this issue, you should review the flagged entries in the DS13 Subcontract table and correct any duplicates. This could involve deleting the duplicate entries or correcting the data if the duplication is due to an error in data entry.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed on the 'DS13 Subcontract' table to check for any duplicate entries in the subcontract tasks. The test is specifically looking for any instances where the combination of subcontract ID, subcontract PO ID, and task ID is repeated more than once. 

The importance of this check is to ensure the uniqueness of each subcontract task. Duplicate entries can lead to confusion, misinterpretation of data, and incorrect analysis. It can also cause issues in tracking the progress of individual tasks and in the overall project management. 

The severity of this test is marked as 'CRITICAL', which is the highest level of severity. This means that if any duplicates are found, they must be corrected before the data can be further reviewed or analyzed. This underscores the critical nature of maintaining data integrity in the EVMS construction project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS13_SubK_PK] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with Dupes as (
		SELECT subK_id, subK_task_id, task_ID
		FROM DS13_subK
		WHERE upload_ID = @upload_ID
		GROUP BY subK_id, subK_task_id, task_ID
		HAVING COUNT(*) > 1
	)
	SELECT
		S.*
	FROM 
		DS13_subK S INNER JOIN Dupes D 	ON S.subK_id = D.subK_id 
										AND S.subK_task_id = D.subK_task_id 
										AND S.task_ID = D.task_ID
	WHERE 
		upload_ID = @upload_ID 
)
```
