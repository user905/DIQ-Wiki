## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS13 Subcontract |
| Severity    | MINOR |
| Unique ID   | 9130516   |
| Summary     | Is the actual finish date misaligned with the actual finish in the forecast schedule? |
| Error message | AF_date <> DS04.AF_date where schedule_type = FC (by task_ID). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "Actual Finish Misaligned with Forecast Schedule" is designed to identify any discrepancies between the actual finish date recorded in the DS13 Subcontract table and the forecasted finish date in the DS04 Schedule table. 

This check is performed by comparing the 'AF_date' field in both tables for each task. If the actual finish date ('AF_date') in the DS13 Subcontract table does not match the forecasted finish date ('AF_date') in the DS04 Schedule table, the DIQ check will flag this as an error.

The likely cause of this error is a mismatch in data entry between the two tables. This could occur if the actual finish date for a task is updated in the DS13 Subcontract table but not in the DS04 Schedule table, or vice versa. 

To resolve this issue, ensure that the actual finish date for each task is consistently updated in both the DS13 Subcontract and DS04 Schedule tables. The expected value for the 'AF_date' field in both tables should be the same for each task.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to check if the actual finish date of a task in the DS13 Subcontract table is not aligned with the actual finish date in the forecast schedule. The test is important because it ensures that the actual completion of tasks aligns with the forecasted schedule. This is crucial for maintaining accurate project timelines and for effective project management.

The severity of this test is marked as an MINOR. This means that while it may not immediately prevent data from being reviewed or cause significant problems during analysis, it could potentially lead to minor issues. For instance, it could cause confusion or inaccuracies when reviewing project timelines or when planning future tasks based on past performance. Therefore, it's recommended to address this issue to ensure the data follows best practices and maintains its integrity and quality.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS13_SubK_IsAFDateMisalignedWithDS04] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	SELECT
		SK.*
	FROM 
		DS13_subK SK INNER JOIN DS04_schedule S ON SK.task_ID = S.task_ID
	WHERE 
			SK.upload_ID = @upload_ID 
		AND S.upload_ID = @upload_ID
		AND SK.AF_date <> S.AF_date
)
```
