## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS05 Schedule Logic |
| Severity    | MINOR |
| Unique ID   | 9050280   |
| Summary     | Is the lag for this task missing a justification? |
| Error message | Lag_days <> 0 and lacking a justification in DS04 schedule (justification_lag is null or blank). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "Lag Missing Justification" is designed to ensure that every task in the DS05 Schedule Logic table that has a lag time (lag_days) also has a corresponding justification for that lag in the DS04 Schedule table. 

The error message "Lag_days <> 0 and lacking a justification in DS04 schedule (justification_lag is null or blank)" indicates that there are tasks in the DS05 Schedule Logic table with a lag time that do not have a corresponding justification in the DS04 Schedule table. 

This error is likely caused by either a data entry error or an oversight during the data entry process. The fields causing the issue are the 'lag_days' field in the DS05 Schedule Logic table and the 'justification_lag' field in the DS04 Schedule table. 

The expected values for these fields are as follows: 
- For the 'lag_days' field in the DS05 Schedule Logic table, any value other than 0 indicates that there is a lag time for the task. 
- For the 'justification_lag' field in the DS04 Schedule table, any value other than null or blank indicates that there is a justification for the lag time. 

To resolve this error, ensure that every task with a lag time in the DS05 Schedule Logic table has a corresponding justification in the DS04 Schedule table.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that all tasks in the DS05 Schedule Logic table that have a lag time (Lag_days not equal to 0) also have a corresponding justification. The test checks if the 'justification_lag' field is null or blank for these tasks. 

The importance of this check is to maintain the integrity and quality of the project schedule data. In project management, any lag time between tasks should be justified to ensure that the schedule is realistic and efficient. Without a justification, it's difficult to understand the reasoning behind the lag time, which could lead to confusion or misinterpretation during project execution or analysis.

The severity of this check is marked as an MINOR. This means that while it's not a critical issue that would prevent the data from being reviewed, it's still a potential problem. It could cause minor issues during analysis or indicate that the data doesn't fully adhere to best practices. Therefore, it's recommended to address this issue to improve the overall quality and reliability of the project schedule data.
## Code

```sql
CREATE FUNCTION [dbo].[fnDIQ_DS05_Logic_IsLagMissingJustification] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	SELECT
		L.*
	FROM
		DS05_schedule_logic L INNER JOIN DS04_schedule S ON L.schedule_type = S.schedule_type 
														AND L.task_ID = S.task_ID
														AND ISNULL(L.subproject_ID,'') = ISNULL(S.subproject_ID,'')
	WHERE
			L.upload_id = @upload_ID
		AND S.upload_ID = @upload_ID
		AND lag_days <> 0
		AND TRIM(ISNULL(justification_lag,''))=''
)
```

### Changelog

| Date       | Description of Changes   |
| ---------- | ------------------------ |
| 2024-04-30 | Logic adjusted to account for 'subproject_id' field, as well as for code maintainability. |
