## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS01 WBS |
| Severity    | MINOR |
| Unique ID   | 1010037   |
| Summary     | Is a CA missing from the ancestry tree of this WP or PP? |
| Error message | WP or PP missing CA ancestry tree |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "WP or PP Missing CA Ancestor" is designed to verify the completeness of the ancestry tree for each Work Package (WP) or Planning Package (PP) in the DS01 Work Breakdown Structure (WBS) table. 

The test checks if there is a Control Account (CA) present in the ancestry tree of each WP or PP. The Control Account is a crucial element in the ancestry tree as it provides a link between the work packages or planning packages and the overall project management structure. 

If the test identifies a WP or PP that does not have a CA in its ancestry tree, it will flag an error with the message "WP or PP missing CA ancestry tree". This error is likely caused by incomplete or incorrect data entry in the WBS_ID field of the DS01 WBS table. 

The expected values for the WBS_ID field should include a reference to a Control Account for each Work Package or Planning Package. If this reference is missing, it may indicate that the WP or PP has not been correctly linked to a Control Account in the project management structure. 

To resolve this issue, review the data entries in the WBS_ID field for each WP or PP in the DS01 WBS table and ensure that they are correctly linked to a Control Account.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that every Work Package (WP) or Planning Package (PP) in the DS01 WBS table has a Control Account (CA) in its ancestry tree. The ancestry tree is a hierarchical structure that shows the relationship between different elements in a project. In the context of an Earned Value Management System (EVMS), a WP or PP should always be associated with a CA, which is a management control point where scope, budget, and schedule are integrated and compared to earned value for performance measurement.

The importance of this check is to ensure that all WPs and PPs are properly linked to a CA. If a WP or PP is missing a CA in its ancestry tree, it could lead to issues in tracking project progress and performance, as the CA is where performance measurement occurs. This could potentially lead to inaccurate reporting and analysis.

The severity of this test is marked as an MINOR. This means that while it's not a critical error that would prevent data from being reviewed, it's still a potential issue that could cause minor problems or indicate that the data doesn't follow all best practices. It's recommended to address this issue to ensure the highest data integrity and quality.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS01_WBS_IsWPorPPLackingCAAncestor] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
		
	SELECT 
		*
	FROM 
		DS01_WBS
	WHERE 
			upload_ID = @upload_ID 
		AND type IN ('WP','PP')
		AND WBS_ID NOT IN (
				SELECT WBS_ID 
				FROM AncestryTree_Get(@upload_ID)
				WHERE Ancestor_Type = 'CA'
			)
)
```
