## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS01 WBS |
| Severity    | MAJOR |
| Unique ID   | 9010004   |
| Summary     | Does the CAM name for this WBS differ from what is in DS04? |
| Error message | CAM name differs between DS01 and DS04. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "Different CAM Name from DS04" is designed to ensure consistency between the Control Account Manager (CAM) names in two different datasets: DS01 WBS and DS04 Schedule. 

The test checks if the CAM name associated with a Work Breakdown Structure (WBS) in DS01 differs from the CAM name for the same WBS in DS04. If there is a discrepancy, the test will flag an error with the message "CAM name differs between DS01 and DS04."

The likely cause of this error is a mismatch in the CAM names between the two datasets. This could occur due to a data entry error, a change in the CAM that was not updated in both datasets, or a discrepancy in the way CAM names are recorded in the two datasets.

The fields causing the issue are the 'CAM' fields in both DS01 WBS and DS04 Schedule. The expected values in these fields should be identical for each corresponding WBS. If the CAM names are not the same, the test will flag an error. 

To resolve this issue, you should review the CAM names in both datasets for the flagged WBS and correct any discrepancies to ensure data consistency.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure consistency between the Control Account Manager (CAM) names in the DS01 WBS (Work Breakdown Structure) table and the DS04 table. The test checks if the CAM name for a particular WBS in the DS01 table is different from what is recorded in the DS04 table. 

The importance of this check lies in maintaining data integrity and quality. Consistency in data across different tables is crucial for accurate analysis and reporting. If the CAM names differ between the two tables, it could lead to confusion, misinterpretation of data, and potential errors in project management decisions. 

The severity of this issue is marked as a MAJOR. This means that while it may not prevent the data from being reviewed, it is likely to cause problems during analysis if not addressed. Therefore, it is recommended to resolve this inconsistency to ensure accurate and reliable data analysis.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS01_WBS_DoesCAMDifferFromDS04CAM] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with Sched as (
		SELECT WBS_ID, CASE WHEN Min(ISNULL(CAM,'')) <> MAX(ISNULL(CAM,'')) Then '$' ELSE MIN(ISNULL(CAM,'')) END as 'CAM'
		FROM DS04_schedule
		WHERE upload_ID = @upload_ID
		GROUP BY WBS_ID
	)
	SELECT 
		W.*
	FROM
		DS01_WBS W INNER JOIN Sched S on W.WBS_ID = S.WBS_ID
	WHERE
			W.upload_ID = @upload_ID
		AND ISNULL(W.CAM,'') <> S.CAM
)
```
