## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS04 Schedule |
| Severity    | MAJOR |
| Unique ID   | 1040130   |
| Summary     | Does RPG exist without an an approve repgrogramming milestone? |
| Error message | Task designated as RPG (RPG = Y) is either marked as the approve RPG MS (miletone_level = 138) or no such milestone found. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "RPG Without Approve Reprogramming Milestone" is designed to ensure that tasks marked as RPG (Reprogramming) in the DS04 Schedule table have an associated approved reprogramming milestone. 

The error message "Task designated as RPG (RPG = Y) is either marked as the approve RPG MS (milestone_level = 138) or no such milestone found" indicates that there are tasks marked as RPG without an associated approved reprogramming milestone (milestone_level = 138). 

This error is likely caused by one of two scenarios. The first scenario is that a task has been marked as RPG (RPG = 'Y') but the milestone_level field does not have the value 138, which represents an approved reprogramming milestone. The second scenario is that there are no approved reprogramming milestones (milestone_level = 138) in the DS04 Schedule table.

To resolve this error, ensure that all tasks marked as RPG have an associated approved reprogramming milestone (milestone_level = 138). If there are no approved reprogramming milestones in the DS04 Schedule table, it may be necessary to add them or review the data entry process to prevent this issue in the future.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed on the 'DS04 Schedule' table to check for any tasks that are designated as RPG (Reprogramming) but do not have an approved reprogramming milestone. The test is designed to identify any instances where a task is marked as RPG (RPG = Y) but is either marked as the approved RPG MS (milestone_level = 138) or no such milestone is found.

The severity of this test is marked as a 'MAJOR', which implies that this issue could potentially cause problems during data analysis. It is important to ensure that all tasks marked as RPG have an associated approved reprogramming milestone. This is because the absence of such a milestone could lead to inaccuracies in project scheduling and budgeting, potentially causing delays and cost overruns.

Therefore, this check is crucial to maintain the integrity and quality of the EVMS construction project management data. It helps to ensure that the data is accurate and reliable, thereby facilitating effective project management and decision-making.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS04_Sched_DoesRpgExistWithoutAppRpgMS] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with RpgMS as (
		SELECT schedule_type
		FROM DS04_schedule 
		WHERE upload_ID=@upload_ID AND milestone_level = 138
	)
	SELECT
		*
	FROM
		DS04_schedule
	WHERE
			upload_id = @upload_ID
		AND RPG = 'Y'
		AND schedule_type = 'FC'
		AND (
			milestone_level = 138 OR (SELECT COUNT(*) FROM RpgMS WHERE schedule_type = 'FC') = 0
		)
	UNION
	SELECT
		*
	FROM
		DS04_schedule
	WHERE
			upload_id = @upload_ID
		AND RPG = 'Y'
		AND schedule_type = 'BL'
		AND (
			milestone_level = 138 OR (SELECT COUNT(*) FROM RpgMS WHERE schedule_type = 'BL') = 0
		)
)
```
