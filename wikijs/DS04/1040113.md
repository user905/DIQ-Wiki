## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS04 Schedule |
| Severity    | MINOR |
| Unique ID   | 1040113   |
| Summary     | Is this task forecasted to start or finish after the end of the PMB? |
| Error message | ES_date or EF_date is later than the ES_date or EF_Date for the End of PMB milestone (milestone_level = 175). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "Task Starts or Finishes after End of PMB" is designed to ensure that no task in the DS04 Schedule is forecasted to start or finish after the end of the Performance Measurement Baseline (PMB). 

The error message "ES_date or EF_date is later than the ES_date or EF_Date for the End of PMB milestone (milestone_level = 175)" indicates that there are tasks in the DS04 Schedule where the Estimated Start (ES_date) or Estimated Finish (EF_date) dates are later than the corresponding dates for the end of the PMB milestone. 

This error is likely caused by incorrect data entry in the ES_date or EF_date fields for certain tasks. The expected values for these fields should be dates that fall within the timeframe of the PMB, i.e., they should not be later than the ES_date or EF_date for the end of the PMB milestone. 

Please review the tasks in the DS04 Schedule and correct the ES_date or EF_date fields as necessary to ensure they align with the PMB timeframe. This check excludes tasks with subtype 'SVT' or 'ZBA' and types 'SM' or 'FM'.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that no task in the DS04 Schedule table is forecasted to start or finish after the end of the Performance Measurement Baseline (PMB). The PMB is a fixed plan against which project performance is measured, and tasks starting or finishing beyond this timeline could indicate potential scheduling issues or delays.

The importance of this check is to maintain the integrity of the project schedule and to ensure that all tasks are planned to be completed within the established timeline. This is crucial for effective project management and for avoiding unexpected delays or cost overruns.

The severity of this test is marked as an MINOR. This means that while it's not a critical error that would prevent data review, it's still a potential issue that could cause minor problems or indicate that the data doesn't fully adhere to best practices. It's a signal to the project management team to review the scheduling of tasks and make necessary adjustments to ensure they align with the PMB.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS04_Sched_AreEarlyDatesLaterThanEndOfPMB] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with ToTest as (
		SELECT schedule_type, ES_date, EF_date
		FROM DS04_schedule			
		WHERE upload_ID = @upload_ID AND milestone_level = 175
	)
	SELECT
		S.*
	FROM
		DS04_schedule S INNER JOIN ToTest T ON S.schedule_type = T.schedule_type
	WHERE
			S.upload_ID = @upload_ID
		AND ISNULL(S.subtype,'') NOT IN ('SVT','ZBA')
		AND type NOT IN ('SM','FM')
		AND (S.ES_date > T.ES_date OR S.EF_date > T.EF_date)
)
```
