## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS04 Schedule |
| Severity    | MAJOR |
| Unique ID   | 1040133   |
| Summary     | Is this non-milestone task marked as an SVT? |
| Error message | Task marked as SVT (subtype = SVT), but is not of the appropriate milestone level (milestone_level = 100-135, 140-175, 190-199, 3xx, or 7xx). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "SVT Not Of Allowed Milestone Type" is designed to ensure that tasks in the DS04 Schedule table are correctly classified. Specifically, it checks whether a task is marked as an SVT (Schedule Variance Threshold) but is not assigned an appropriate milestone level.

The error message "Task marked as SVT (subtype = SVT), but is not of the appropriate milestone level (milestone_level = 100-135, 140-175, 190-199, 3xx, or 7xx)" indicates that the task has been incorrectly marked as an SVT. This could be due to a data entry error or a misunderstanding of the classification system.

The fields causing the issue are 'subtype' and 'milestone_level'. The 'subtype' field should only be marked as 'SVT' if the task is of the appropriate milestone level. The 'milestone_level' field should be within the ranges 100-135, 140-175, 190-199, 300-399, or 700-799 for tasks marked as SVT.

If the 'subtype' field is marked as 'SVT' but the 'milestone_level' is not within these ranges, the DIQ check will flag this as an error. To resolve this issue, review the task's classification and ensure that it is correctly marked as an SVT and assigned an appropriate milestone level.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that tasks in the DS04 Schedule table are correctly marked as Schedule Variance Threshold (SVT) only if they are of the appropriate milestone level. The test checks if a non-milestone task is incorrectly marked as an SVT. 

The importance of this check is to maintain the accuracy and reliability of the project schedule data. If tasks are incorrectly marked as SVTs, it could lead to misinterpretation of the project's progress and performance, potentially causing issues in project management and decision-making processes. 

The severity of this test is marked as a MAJOR. This means that while it may not prevent the data from being reviewed, it is likely to cause problems during analysis. Therefore, it is crucial to address this issue to ensure the integrity and quality of the project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS04_Sched_DoesSVTHaveIncorrectMSLevel] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	SELECT
		*
	FROM
		DS04_schedule
	WHERE
			upload_id = @upload_ID
		AND ISNULL(subtype,'') = 'SVT'
		AND NOT (
			milestone_level BETWEEN 100 AND 135 OR 
			milestone_level BETWEEN 140 AND 170 OR
			milestone_level BETWEEN 190 AND 199 OR
			milestone_level BETWEEN 300 AND 399 OR
			milestone_level BETWEEN 700 AND 799
		)
)
```
