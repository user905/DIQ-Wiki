## Basic Information

| Key           | Value                                                                                                            |
| ------------- | ---------------------------------------------------------------------------------------------------------------- |
| Table         | DS04 Schedule                                                                                                    |
| Severity      | MAJOR                                                                                                          |
| Unique ID     | 1040193                                                                                                          |
| Summary       | Is this milestone after the Approve Finish Project Milestone?                                                    |
| Error message | Milestone EF_Date > EF_Date for the Approve Finish Project Milestone (milestone_level = 199) (by subproject_ID). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
> {.is-warning}

The Data Integrity and Quality (DIQ) check titled "Milestone After Approve Finish Project" is designed to ensure that no milestones in the DS04 Schedule table have an early finish date (EF_Date) that is later than the approved finish project milestone.

The approved finish project milestone is identified by a milestone level of 199. If a milestone has an EF_Date later than this approved finish project milestone, it indicates a potential issue with the project scheduling data.

The error message "Milestone has an early finish date (EF_Date) later than the approve finish project milestone (milestone_level = 199)" is triggered when this condition is met. This could be due to incorrect data entry or a scheduling error in the project management process.

To resolve this issue, review the milestones in the DS04 Schedule table, particularly focusing on the EF_Date and milestone_level fields. Ensure that the EF_Date for all milestones is not later than the EF_Date of the milestone with a milestone_level of 199. If any discrepancies are found, correct the data to reflect the accurate project schedule.

## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
> {.is-warning}

This test, titled "Milestone After Approve Finish Project", is being performed on the 'DS04 Schedule' table to check if there are any milestones that have an early finish date (EF_Date) that is later than the approved finish project milestone. This is important because it helps to ensure that the project is following the approved timeline and that no milestones are scheduled to be completed after the project has been approved to finish.

The severity of this test is marked as 'MAJOR', which means that while it may not prevent the data from being reviewed, it could potentially cause problems during the analysis. If a milestone is scheduled to be completed after the project has been approved to finish, it could indicate a problem with the project scheduling or a delay in the completion of the milestone. This could potentially impact the overall project timeline and result in delays or cost overruns.

Therefore, this check is crucial in maintaining the integrity and quality of the EVMS construction project management data. It helps to ensure that the project is being managed effectively and that all milestones are being completed within the approved project timeline.

## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS04_Sched_IsMSLaterThanAppFinishProj] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	with MS199 as (
		SELECT EF_Date, schedule_type, ISNULL(subproject_ID,'') SubP
		FROM DS04_schedule
		WHERE upload_ID = @upload_ID AND milestone_level = 199
	)
	SELECT
		S.*
	FROM
		DS04_schedule S INNER JOIN MS199 M 	ON S.schedule_type = M.schedule_type
											AND ISNULL(S.subproject_ID,'') = M.SubP
											AND S.EF_date > M.EF_date
	WHERE
			upload_id = @upload_ID
		AND S.milestone_level <> 199
		AND S.milestone_level IS NOT NULL
)
```

### Changelog

| Date       | Description of Changes                                               |
| ---------- | -------------------------------------------------------------------- |
| 2024-04-30 | Logic adjusted to account for the addition of 'subproject_ID' field. |
