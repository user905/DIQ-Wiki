## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS17 WBS EU |
| Severity    | ALERT |
| Unique ID   | 9170579   |
| Summary     | Is this WBS_ID / EOC combo missing in the cost processor? |
| Error message | Combo of WBS_ID_WP & EOC missin in DS03. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "WBS & EOC Combo Missing in Cost" is designed to ensure that each combination of Work Breakdown Structure ID (WBS_ID) and Element of Cost (EOC) in the DS17 WBS EU table is also present in the DS03 Cost table. 

If this DIQ check fails, it indicates that there are combinations of WBS_ID and EOC in the DS17 WBS EU table that are not found in the DS03 Cost table. This discrepancy could be due to missing or incorrect entries in the DS03 Cost table. 

The fields causing the issue are the WBS_ID and EOC fields in both the DS17 WBS EU and DS03 Cost tables. The expected values for these fields are that every combination of WBS_ID and EOC in the DS17 WBS EU table should also be present in the DS03 Cost table. 

To resolve this issue, you should review the entries in the DS03 Cost table to ensure that all combinations of WBS_ID and EOC from the DS17 WBS EU table are included.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to check the consistency and completeness of the data in the 'DS17 WBS EU' table. Specifically, it is looking for any instances where the combination of 'WBS_ID' and 'EOC' (End of Contract) is missing in the cost processor, as indicated by their absence in the 'DS03' dataset. 

The importance of this check lies in ensuring that all necessary data is present for accurate cost processing. The 'WBS_ID' and 'EOC' combination is likely crucial for calculating and tracking costs associated with different work breakdown structures (WBS) and their respective contract end dates. If this data is missing, it could lead to inaccuracies or gaps in cost analysis and financial reporting.

The severity of this check is classified as an 'ALERT'. This means that while it may not immediately prevent data review or analysis, it could potentially cause minor problems or indicate that the data does not fully adhere to best practices. It is advisable to address this issue to maintain high data integrity and quality.
## Code

```sql
CREATE FUNCTION [dbo].[fnDIQ_DS17_WBS_EU_IsWBSAndEOCComboNotInDS03] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	with CostWBS as (
		SELECT CONCAT(WBS_ID_WP,'-', CASE WHEN ISNULL(is_indirect,'') = 'Y' THEN 'Indirect' ELSE EOC END) WBSEOC
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND TRIM(ISNULL(WBS_ID_WP,'')) <> ''
		GROUP BY CONCAT(WBS_ID_WP,'-', CASE WHEN ISNULL(is_indirect,'') = 'Y' THEN 'Indirect' ELSE EOC END) 
	)
	SELECT 
		*
	FROM 
		DS17_WBS_EU
	WHERE 
			upload_ID = @upload_ID
		AND CONCAT(WBS_ID,'-', EOC) NOT IN (SELECT WBSEOC FROM CostWBS)
)
```

### Changelog

| Date       | Description of Changes   |
| ---------- | ------------------------ |
| 2024-04-30 | Logic adjusted to account for addition of 'is_indirect' field. |
