## Basic Information

| Key           | Value                                                       |
| ------------- | ----------------------------------------------------------- |
| Table         | DS06 Resources                                              |
| Severity      | WARNING                                                     |
| Unique ID     | 9060296                                                     |
| Summary       | Is this resource scheduled to finish after its parent task? |
| Error message | Resource finish (finish_date) > DS04.EF_date (by task_ID).  |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
> {.is-warning}

The Data Integrity and Quality (DIQ) check titled "Resource Finishing Later Than Task" is designed to ensure that no resource in the DS06 Resources table is scheduled to finish after its associated task in the DS04 Schedule table.

The test compares the 'finish_date' field of each resource in DS06 with the 'EF_date' (Expected Finish date) of its corresponding task in DS04. If the finish date of the resource is later than the expected finish date of the task, the test will flag this as an error.

This error could be caused by incorrect data entry or scheduling issues. For instance, a resource might have been mistakenly scheduled to finish after the task it is assigned to, or the expected finish date of the task might have been set too early.

To resolve this issue, you should ensure that the 'finish_date' for each resource in DS06 is on or before the 'EF_date' of its corresponding task in DS04. This will ensure that all resources are scheduled to finish their tasks within the expected timeframe.

## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
> {.is-warning}

This test is being performed to ensure that no resource is scheduled to finish after its parent task in the DS06 Resources table. The test checks if the finish date of a resource is later than the estimated finish date of its corresponding task.

The importance of this check lies in maintaining the accuracy and reliability of the project schedule. If a resource is scheduled to finish after its parent task, it could lead to delays in the project timeline, misallocation of resources, and potential cost overruns.

The severity of this test is marked as a WARNING. This means that while it may not immediately prevent the data from being reviewed, it is likely to cause problems during the analysis of the project management data. It is crucial to address this issue to ensure the integrity of the project schedule and to avoid potential complications in project execution.

## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS06_Res_IsFinishDateLaterThanDS04EFDate] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	with BL as (
		SELECT task_ID, ISNULL(subproject_ID,'') SubP, EF_date
		FROM DS04_schedule
		WHERE upload_ID = @upload_ID AND schedule_type = 'BL'
	)
	SELECT R.*
	FROM DS06_schedule_resources R INNER JOIN BL B ON R.task_ID = B.task_ID
												  AND ISNULL(R.subproject_ID,'') = B.SubP
												  AND R.finish_date > B.EF_date
	WHERE	R.upload_id = @upload_ID
		AND R.schedule_type = 'BL'
)
```

### Changelog

| Date       | Description of Changes                                                                                                                   |
| ---------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| 2024-04-30 | Logic adjusted to account for 'subproject_id' field. Additionally, the query now explicitly filters resources by 'schedule_type = 'BL''. |
