## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS03 Cost |
| Severity    | WARNING |
| Unique ID   | 1030095   |
| Summary     | Does this WP/PP comingle Material with other EOC types (excluding Indirect)? |
| Error message | EOC = Material & Subcontract, ODC, or Labor by WBS_ID_WP. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This Data Integrity and Quality (DIQ) check is designed to ensure that within the DS03 Cost table, work package or planning package (WP/PP) entries do not improperly mix Material costs with other types of Elements of Cost (EOCs), excluding Indirect costs. Specifically, it verifies that entries categorized under the EOC as 'Material' are not combined in the same WP/PP with entries categorized as 'Subcontract', 'ODC' (Other Direct Costs), or 'Labor'. 

The error highlighted by this DIQ check suggests that there are instances where Material costs are being reported alongside other direct cost categories within the same work package or planning package identifier (WBS_ID_WP). This is not in alignment with proper cost categorization practices, as it can lead to inaccuracies in tracking and reporting project costs. 

The fields causing the issue are primarily the 'EOC' (Element of Cost) and 'WBS_ID_WP' (Work Breakdown Structure ID for Work Package/Planning Package). The expected behavior is that each WP/PP should exclusively contain Material costs or other direct costs but not a mixture of both, with the exception of Indirect costs which are not part of this check.

To resolve this issue, review the affected WP/PP entries to ensure that costs are correctly categorized and segregated by their EOC type. This may involve adjusting the EOC categorization for some entries or reassigning costs to the appropriate WP/PP to maintain clear separation between Material costs and other types of direct costs.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This DIQ test is performed on the 'DS03 Cost' table to ensure that Work Packages (WP) or Planning Packages (PP) do not improperly mix Material costs with other types of Elements of Cost (EOC), such as Subcontract, Other Direct Costs (ODC), or Labor, excluding Indirect costs. The purpose of this test is to maintain the integrity and clarity of cost reporting within the project management system. By identifying instances where Material costs are commingled with other EOC types, the test aims to prevent potential misallocation of costs, which could lead to inaccurate project cost tracking, reporting, and analysis. The severity level of WARNING indicates that while this issue may not immediately invalidate the data, it is likely to cause problems during cost analysis or financial audits, potentially leading to budgetary discrepancies or misinterpretations of the project's financial health. Ensuring that costs are properly categorized according to their nature is crucial for accurate budgeting, forecasting, and financial reporting, which in turn supports effective project management and decision-making.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS03_Cost_IsMatComingledWithNonIndirectEOCs] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	with NonMaterial AS (
		SELECT WBS_ID_WP WPID
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND EOC NOT IN ('Material','Indirect') AND TRIM(ISNULL(WBS_ID_WP,'')) <> ''
		GROUP BY WBS_ID_WP
	)
	SELECT C.* 
	FROM DS03_Cost C LEFT OUTER JOIN NonMaterial N ON C.WBS_ID_WP = N.WPID
	WHERE	upload_ID = @upload_ID AND EOC = 'Material' AND N.WPID IS NOT NULL
)
```
