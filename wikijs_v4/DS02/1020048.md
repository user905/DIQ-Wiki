## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS02 OBS |
| Severity    | ERROR |
| Unique ID   | 1020048   |
| Summary     | Is the parent lower in the OBS hierarchy than its child? |
| Error message | Parent found at a lower level in the OBS hierarchy than its child, i.e. Parent Level > Child Level. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "Parent Lower in OBS Hierarchy than Child" is designed to ensure that the hierarchical structure of the Organizational Breakdown Structure (OBS) in the DS02 OBS table is maintained correctly. 

The error message "Parent found at a lower level in the OBS hierarchy than its child, i.e. Parent Level > Child Level" indicates that there is an inconsistency in the hierarchical structure. Specifically, it means that a parent OBS is positioned at a lower level in the hierarchy than its child OBS. 

This issue is likely caused by incorrect data entry in the 'Level' and 'parent_OBS_ID' fields of the DS02 OBS table. The 'Level' field should contain a higher value for a parent OBS compared to its child OBS. Similarly, the 'parent_OBS_ID' field of a child OBS should correctly reference the 'OBS_ID' of its parent OBS. 

To resolve this issue, ensure that the 'Level' field for each parent OBS is less than the 'Level' field of its child OBS. Also, verify that the 'parent_OBS_ID' field of each child OBS correctly references the 'OBS_ID' of its parent OBS.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure the correct hierarchical structure of the Organizational Breakdown Structure (OBS) in the DS02 OBS table. The OBS is a critical component of project management, providing a detailed, hierarchical representation of the project's organization. It is essential for tracking responsibilities, costs, and work packages.

The test is checking if any parent is found at a lower level in the OBS hierarchy than its child, which would be an incorrect configuration. In a proper hierarchy, a parent should always be at a higher level than its child (i.e., Parent Level < Child Level). 

The severity of this test is marked as 'ERROR', the highest level of severity. This means that if this issue is present, it must be fixed before the data can be reviewed. This is because an incorrect OBS hierarchy could lead to significant problems in project management, such as misallocation of resources, incorrect tracking of costs, and confusion in responsibilities. Therefore, ensuring the correct OBS hierarchy is a crucial aspect of Data Integrity and Quality (DIQ) checks.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS02_OBS_IsParentLowerInOBSHierarchyThanChild] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
    -- Insert statements for procedure here
	SELECT 
		Child.* 
	FROM 
		DS02_OBS Child,
		(SELECT OBS_ID, [Level] FROM DS02_OBS WHERE upload_ID=@upload_ID) Parent
	WHERE 
			upload_ID = @upload_ID
		AND Child.parent_OBS_ID=Parent.OBS_ID
		AND Child.[Level]<=Parent.[Level]
)
```
