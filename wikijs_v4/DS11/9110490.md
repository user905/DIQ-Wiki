## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS11 Variance |
| Severity    | WARNING |
| Unique ID   | 9110490   |
| Summary     | Is this project-level VAR not at Level 1 in the WBS Hierarchy? |
| Error message | narrative_type < 200 & DS01.level > 1 (by WBS_ID). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "Project-Level VAR Misaligned With Project-Level WBS" is designed to ensure that the project-level Variance at Completion (VAR) aligns correctly with the Work Breakdown Structure (WBS) hierarchy in the DS11 Variance and DS01 WBS tables respectively.

The error message "narrative_type < 200 & DS01.level > 1 (by WBS_ID)" indicates that the VAR is not at Level 1 in the WBS hierarchy, which is the expected level for project-level VAR. This misalignment could be due to incorrect data entry or a mismatch in the data structure between the DS11 Variance and DS01 WBS tables.

The fields causing this issue are the 'narrative_type' field in the DS11 Variance table and the 'level' field in the DS01 WBS table. The expected values for these fields are less than 200 for 'narrative_type' and 1 for 'level'. If these conditions are not met, the DIQ check will flag an error. 

To resolve this issue, ensure that the 'narrative_type' field in the DS11 Variance table is less than 200 and the 'level' field in the DS01 WBS table is set to 1. This will ensure that the project-level VAR aligns correctly with the project-level WBS.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the project-level Variance at Completion (VAR) aligns correctly with the project-level Work Breakdown Structure (WBS). The test checks if the VAR is not at Level 1 in the WBS hierarchy, which is a potential issue. The severity of this test is marked as a WARNING, indicating that if this issue is not addressed, it could cause problems during the analysis of the data.

The importance of this check lies in maintaining the integrity and accuracy of the project management data. The VAR and WBS are crucial components of the Earned Value Management System (EVMS) used in project management. The VAR provides a measure of the expected financial performance of the project, while the WBS breaks down the project into manageable sections. If the VAR is not correctly aligned with the WBS, it could lead to inaccurate projections and mismanagement of resources. Therefore, this check is essential to ensure the successful management and completion of the project.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS11_VAR_IsProjectLevelVARMisalignedWithDS01Type] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	SELECT
		V.*
	FROM 
		DS11_variance V INNER JOIN DS01_WBS W ON V.WBS_ID = W.WBS_ID
	WHERE 
			V.upload_ID = @upload_ID
		AND W.upload_ID = @upload_ID
		AND CAST(ISNULL(narrative_type,'1000') as int) < 200 
		AND W.[level] <> 1
)
```
