## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS06 Resources |
| Severity    | WARNING |
| Unique ID   | 9060289   |
| Summary     | Are there labor actual hours in cost without labor performance units in resources? |
| Error message | Resource labor performance units = 0 (actual_units where EOC or type = Labor) while cost labor actuals hours > 0 (SUM of DS03.ACWPi_hours where EOC = Labor). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "Cost Labor Actuals without Resource Labor Performance" is designed to identify discrepancies between labor actual hours and labor performance units in the DS06 Resources and DS03 Cost tables. 

The test is checking for instances where there are actual labor hours recorded in the DS03 Cost table (where EOC or type is 'Labor'), but there are no corresponding labor performance units in the DS06 Resources table. This could indicate a data entry error or a missing update in one of the tables.

The fields causing the issue are the 'actual_units' field in the DS06 Resources table and the 'ACWPi_hours' field in the DS03 Cost table. The expected values would be that for every labor actual hour recorded in the DS03 Cost table, there should be a corresponding labor performance unit in the DS06 Resources table. 

If the test returns a positive result, it means that there are labor actual hours in the DS03 Cost table that do not have corresponding labor performance units in the DS06 Resources table. This discrepancy should be investigated and corrected to ensure data integrity and quality.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that there is a match between the actual labor hours recorded in the cost data and the labor performance units in the resource data. The test is checking for instances where there are actual labor hours recorded in the cost data (DS03.ACWPi_hours where EOC = Labor) but no corresponding labor performance units in the resource data (actual_units where EOC or type = Labor).

The importance of this check is to maintain the integrity and accuracy of the labor cost and resource data. If there are labor hours recorded in the cost data but no corresponding labor performance units in the resource data, it could indicate a data entry error or a discrepancy between the cost and resource data. This could potentially lead to inaccurate cost calculations or misinterpretation of the labor performance data.

The severity of this check is marked as a WARNING, which means that while it may not prevent the data from being reviewed, it is likely to cause problems during analysis. It is therefore recommended that this issue be addressed to ensure the accuracy and reliability of the data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS06_Res_AreDS03LaborAHoursMissingResourceLaborPUnits] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with CostWBS as (
		--cost WPs with A labor hours
		SELECT WBS_ID_WP WBS
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND EOC = 'Labor'
		GROUP BY WBS_ID_WP
		HAVING SUM(ACWPi_hours) > 0
	), Resources as (
		--resource labor performance by task_ID
		SELECT task_ID, SUM(ISNULL(actual_units,0)) ResLbrUnits
		FROM DS06_schedule_resources
		WHERE upload_ID = @upload_id AND schedule_type = 'FC' AND (EOC = 'Labor' Or [type] = 'Labor')
		GROUP BY task_ID
	), ScheduleWBS as (
		--schedule WPs missing labor resources
		--left join and filter for LbrUnits = 0 or where the join misses
		SELECT S.WBS_ID WBS
		FROM DS04_schedule S LEFT OUTER JOIN Resources R ON S.task_ID = R.task_ID
		WHERE S.upload_ID = @upload_id AND S.schedule_type = 'FC' AND (ResLbrUnits = 0 OR R.task_ID IS NULL)
		GROUP BY S.WBS_ID
	), FlagsByWBS as (
		--join CostWBS
```
