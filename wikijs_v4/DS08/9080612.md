## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS08 WAD |
| Severity    | WARNING |
| Unique ID   | 9080612   |
| Summary     | Is the POP finish for this Work Package WAD before the last recorded SPAE value in cost? |
| Error message | pop_finish_date < max DS03.period_date where BCWS, BCWP, ACWP, or ETC <> 0 (by WP WBS ID). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "POP Finish Before Cost Finish (WP)" is designed to ensure that the Planned Operational Period (POP) finish date for a Work Package (WP) in the DS08 Work Authorization Document (WAD) table is not earlier than the last recorded Schedule Performance Analysis Element (SPAE) value in cost. 

This check is performed by comparing the 'pop_finish_date' field in the DS08 WAD table with the maximum 'period_date' from the DS03 Cost table, where any of the cost fields (BCWSi, BCWPi, ACWPi, or ETCi) in dollars, hours, or FTEs are not equal to zero. 

If the 'pop_finish_date' is earlier than the maximum 'period_date', an error will be flagged. This could be caused by incorrect data entry in either the 'pop_finish_date' field in the DS08 WAD table or the 'period_date' field in the DS03 Cost table. 

The expected values for the 'pop_finish_date' should be a date that is on or after the maximum 'period_date' from the DS03 Cost table for the corresponding Work Package. 

Please ensure that the 'pop_finish_date' in the DS08 WAD table is correctly entered and is not before the last recorded SPAE value in cost from the DS03 Cost table.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the Planned Order of Production (POP) finish date for a particular Work Package (WP) is not set before the last recorded Schedule Performance Analysis Evaluation (SPAE) value in cost. This is important because it helps to maintain the accuracy and consistency of the project timeline and cost data. If the POP finish date is before the last recorded SPAE value, it could indicate that there are errors or inconsistencies in the scheduling or cost data, which could potentially lead to issues in project management and financial analysis.

The severity of this check is marked as a WARNING, which means that while it may not prevent the data from being reviewed, it could cause problems during analysis. This could include inaccurate projections or analysis results, which could in turn lead to incorrect decision-making or resource allocation. Therefore, it is important to address this issue to ensure the integrity and quality of the project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS08_WAD_IsPOPFinishBeforeDS03FinishWP] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with CostFinish as (
		SELECT WBS_ID_WP WPWBS, MAX(period_date) Period
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND (
			BCWSi_dollars <> 0 OR BCWSi_hours <> 0 OR BCWSi_FTEs <> 0 OR
			BCWPi_dollars <> 0 OR BCWPi_hours <> 0 OR BCWPi_FTEs <> 0 OR
			ACWPi_dollars <> 0 OR ACWPi_hours <> 0 OR ACWPi_FTEs <> 0 OR
			ETCi_dollars <> 0 OR ETCi_hours <> 0 OR ETCi_FTEs <> 0
		)
		GROUP BY WBS_ID_WP
	)
	SELECT 
		W.*
	FROM 
		DS08_WAD W 
			INNER JOIN LatestWPWADRev_Get(@upload_ID) R ON W.WBS_ID_WP = R.WBS_ID_WP AND W.auth_PM_date = R.PMAuth
			INNER JOIN CostFinish C ON W.WBS_ID_WP = C.WPWBS
	WHERE 
			upload_ID = @upload_ID
		AND POP_finish_date < C.[Period]
)
```
