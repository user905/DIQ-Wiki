## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS08 WAD |
| Severity    | ALERT |
| Unique ID   | 9080605   |
| Summary     | Is the POP finish for this Control Account WAD before the forecast early finish? |
| Error message | pop_finish < DS04.EF_date where schedule_type = FC (by DS08.WBS_ID & DS04.WBS_ID via DS01.WBS_ID & DS01.parent_WBS_ID). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "POP Finish Before Forecast Early Finish (CA)" is designed to ensure that the Planned Operation Period (POP) finish date for a Control Account Work Authorization Document (WAD) in the DS08 WAD table is not earlier than the forecasted early finish date in the DS04 Schedule table.

The error message "pop_finish < DS04.EF_date where schedule_type = FC" indicates that the POP finish date is earlier than the forecasted early finish date for a given Control Account. This discrepancy could be due to incorrect data entry or a scheduling error.

The fields causing the issue are the POP_finish_date in the DS08 WAD table and the EF_date in the DS04 Schedule table. The expected value is that the POP_finish_date should be on or after the EF_date when the schedule_type is 'FC' (Forecast).

The DIQ check is performed by comparing the POP finish date for each Control Account WAD with the maximum forecasted early finish date for the corresponding Control Account in the DS04 Schedule table. If the POP finish date is earlier, the DIQ check will flag this as an error. 

Please ensure that the POP finish dates in the DS08 WAD table are correctly entered and are not earlier than the forecasted early finish dates in the DS04 Schedule table.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the Planned Operation Period (POP) finish for a specific Control Account Work Authorization Document (WAD) does not occur before the forecasted early finish. The test is checking if the 'pop_finish' is less than the 'DS04.EF_date' where the schedule type is 'FC'. This is done by matching the 'DS08.WBS_ID' and 'DS04.WBS_ID' via 'DS01.WBS_ID' and 'DS01.parent_WBS_ID'.

The importance of this check is to maintain the integrity of the project schedule. If the POP finish is before the forecasted early finish, it could indicate a scheduling error or unrealistic expectations for project completion. This could lead to potential issues in project management, such as resource misallocation or incorrect timeline predictions.

The severity of this check is marked as an ALERT. This means that while it may not immediately prevent data review or cause significant problems during analysis, it could potentially lead to minor issues or indicate that the data does not fully adhere to best practices. It's a signal to review the scheduling data and make necessary adjustments to ensure accurate and realistic project management.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS08_WAD_IsPOPFinishBeforeDS04FCEFDateCA] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with CAFinish as (
		SELECT A.CAWBS, MAX(S.EF_date) EF
		FROM
			DS04_schedule S INNER JOIN (
				SELECT Ancestor_WBS_ID CAWBS, WBS_ID WPWBS 
				FROM AncestryTree_Get(@upload_ID) 
				WHERE type = 'WP' AND Ancestor_Type = 'CA') A ON S.WBS_ID = A.WPWBS
		WHERE
				S.upload_ID = @upload_ID
			AND S.schedule_type = 'FC'
		GROUP BY A.CAWBS
	)
	SELECT 
		W.*
	FROM
		DS08_WAD W 	INNER JOIN CAFinish C ON W.WBS_ID = C.CAWBS
										  AND W.POP_finish_date <> C.EF
					INNER JOIN LatestCAWADRev_Get(@upload_ID) R ON W.WBS_ID = R.WBS_ID
																AND W.auth_PM_date = R.PMAuth 
	WHERE
			upload_ID = @upload_ID  
		AND TRIM(ISNULL(W.WBS_ID_WP,'')) = ''
)
```
