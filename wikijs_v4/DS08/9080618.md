## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS08 WAD |
| Severity    | WARNING |
| Unique ID   | 9080618   |
| Summary     | Is the POP Start for this Control Account WAD after the forecast start? |
| Error message | POP_start_date > DS04.ES_date where schedule_type = BL (compare by DS08.WBS_ID, DS01.WBS_ID, DS01.parent_WBS_ID, & DS04.WBS_ID). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "POP Start After Schedule Forecast Start (CA)" is designed to ensure that the Period of Performance (POP) start date for a Control Account Work Authorization Document (WAD) in DS08 WAD table does not occur after the forecast start date in DS04 schedule table. 

The fields involved in this check are the POP_start_date from DS08 WAD table and the ES_date from DS04 schedule table. The check is performed by comparing these two dates for each Control Account WAD. 

If an error is flagged by this DIQ check, it means that the POP start date for a Control Account WAD is later than the forecast start date. This could be due to a data entry error or a scheduling issue. 

The expected values for this check would be that the POP_start_date should always be on or before the ES_date. If the POP_start_date is after the ES_date, it indicates a potential issue with the scheduling or data entry that needs to be addressed. 

Please note that this check is performed at the Control Account level and does not include Work Package-level WADs.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the Period of Performance (POP) start date for a specific Control Account Work Authorization Document (WAD) does not occur after the forecasted start date. The test is comparing the POP start date with the Early Start (ES) date from the DS04 table, specifically for baseline (BL) schedule types. The comparison is made using the Work Breakdown Structure (WBS) ID and parent WBS ID from the DS01 and DS04 tables, and the WBS ID from the DS08 table.

The importance of this check is to maintain the integrity and accuracy of the project schedule. If the POP start date is after the forecasted start date, it could indicate a potential delay in the project schedule, which could lead to cost overruns and other project management issues. This check is classified as a WARNING, meaning that while it may not prevent the data from being reviewed, it could cause problems during the analysis of the project schedule and should be addressed to ensure accurate and reliable project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS08_WAD_IsPOPStartAfterDS04ESDateCA] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with SchedStart as (
		--Get the first BL ES date by CA/SLPP ID from DS04 joined to AncestryTree.
		SELECT A.Ancestor_WBS_ID CAWBS, MIN(ES_date) ES
		FROM 
			DS04_schedule S INNER JOIN AncestryTree_Get(@upload_ID) A ON S.WBS_ID = A.WBS_ID
		WHERE
				S.upload_ID = @upload_ID
			AND A.[Type] IN ('WP','PP')
			AND A.Ancestor_Type IN ('CA','SLPP')
			AND S.schedule_type = 'BL'
		GROUP BY A.Ancestor_WBS_ID
	)
	SELECT 
		W.*
	FROM
		DS08_WAD W 	INNER JOIN LatestCAWADRev_Get(@upload_ID) R ON W.WBS_ID = R.WBS_ID 
																AND W.auth_PM_date = R.PMauth
					INNER JOIN SchedStart S ON W.WBS_ID = S.CAWBS
											AND W.POP_start_date > S.ES
	WHERE
			W.upload_ID = @upload_ID
		AND TRIM(ISNULL(W.WBS_ID_WP,'')) = '' -- filter out WP-level WADs
)
```
