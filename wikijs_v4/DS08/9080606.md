## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS08 WAD |
| Severity    | ALERT |
| Unique ID   | 9080606   |
| Summary     | Is the POP finish for this Work Package WAD before the forecast early finish date? |
| Error message | pop_finish < DS04.EF_date where schedule_type = FC (by DS08.WBS_ID_WP & DS04.WBS_ID_WP). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "POP Finish Before Forecast Early Finish (WP)" is designed to ensure that the Planned Outage Period (POP) finish date for a Work Package (WP) in the DS08 WAD table is not earlier than the forecasted early finish date in the DS04 Schedule table.

This check is important for maintaining the integrity of the project schedule and ensuring that the planned work aligns with the forecasted schedule. If the POP finish date is earlier than the forecasted early finish date, it could indicate a scheduling error or misalignment between planned and forecasted work.

The fields involved in this check are the 'POP_finish_date' from the DS08 WAD table and the 'EF_date' from the DS04 Schedule table. The check is performed by comparing these two dates for each Work Package. The 'schedule_type' field in the DS04 Schedule table is also considered, and the check is only performed for records where 'schedule_type' is 'FC', indicating a forecasted schedule.

If this DIQ check fails, it is likely due to one of the following reasons:

1. The 'POP_finish_date' in the DS08 WAD table is incorrectly entered or updated, causing it to be earlier than the 'EF_date' in the DS04 Schedule table.

2. The 'EF_date' in the DS04 Schedule table is incorrectly entered or updated, causing it to be later than the 'POP_finish_date' in the DS08 WAD table.

3. There is a misalignment between the planned work (as indicated by the 'POP_finish_date' in the DS08 WAD table) and the forecasted schedule (as indicated by the 'EF_date' in the DS04 Schedule table).

To resolve this issue, review the 'POP_finish_date' and 'EF_date' for the affected Work Packages and ensure that they are correctly entered and align with the project schedule.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the Planned Operation Period (POP) finish date for a particular Work Package (WP) in the DS08 WAD table is not set before the forecasted early finish date in the DS04 table. The test is checking for any instances where 'pop_finish' is less than 'DS04.EF_date' for the same Work Package, as identified by matching 'DS08.WBS_ID_WP' and 'DS04.WBS_ID_WP'.

The importance of this check is to maintain the integrity and accuracy of the project schedule. If the POP finish date is set before the forecasted early finish date, it could lead to confusion, miscommunication, or incorrect assumptions about the project timeline. This could potentially cause delays or inefficiencies in the project management process.

The severity of this check is classified as an ALERT. This means that while it may not necessarily prevent the data from being reviewed or analyzed, it could potentially cause minor problems or indicate that the data does not fully adhere to best practices. Therefore, it is recommended to address this issue to ensure the highest quality and accuracy of the project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS08_WAD_IsPOPFinishBeforeDS04FCEFDateWP] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with WPFinish as (
		SELECT WBS_ID WBS, MAX(EF_date) EF
		FROM DS04_schedule
		WHERE upload_ID = @upload_ID AND schedule_type = 'FC'
		GROUP BY WBS_ID
	)
	SELECT 
		W.*
	FROM
		DS08_WAD W 	INNER JOIN WPFinish C ON W.WBS_ID_WP = C.WBS	
										  AND W.POP_finish_date < C.EF
					INNER JOIN LatestWPWADRev_Get(@upload_ID) R ON W.WBS_ID_WP = R.WBS_ID_WP
																AND W.auth_PM_date = R.PMAuth
	WHERE
		upload_ID = @upload_ID  
)
```
