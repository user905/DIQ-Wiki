## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS08 WAD |
| Severity    | WARNING |
| Unique ID   | 9080396   |
| Summary     | Are the subcontract budget dollars for this CA WAD misaligned with what is in cost? |
| Error message | budget_subcontract_dollars <> SUM(DS03.BCWSi_dollars) where EOC = subcontract (by WBS_ID_CA). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check for the DS08 WAD table, titled "CA Subcontract Dollars Misaligned With Cost", is designed to identify any discrepancies between the subcontract budget dollars for a given Control Account (CA) Work Authorization Document (WAD) and the corresponding cost data in the DS03 cost table.

The test is specifically looking for instances where the 'budget_subcontract_dollars' field in the DS08 WAD table does not match the sum of 'BCWSi_dollars' for the same CA in the DS03 cost table, where the 'EOC' (Element of Cost) is designated as 'Subcontract'. 

If the test identifies a discrepancy, it means that the budgeted subcontract dollars for a particular CA WAD do not align with the actual cost data. This could be due to a data entry error, a miscalculation, or a change in the subcontract budget that has not been reflected in the cost data. 

The fields causing the issue are 'budget_subcontract_dollars' in the DS08 WAD table and 'BCWSi_dollars' in the DS03 cost table. The expected values for these fields would be equal amounts, indicating that the budgeted subcontract dollars align with the actual cost data. 

Please note that this test only applies to records where the 'WBS_ID_WP' field in the DS08 WAD table is empty. This field is used to identify the Work Package (WP) associated with a CA, so if it is empty, it means that the CA does not have a WP associated with it.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the subcontract budget dollars for a particular Control Account (CA) Work Authorization Document (WAD) align with the cost data. The test is comparing the budgeted subcontract dollars with the sum of the Budgeted Cost of Work Scheduled (BCWSi) dollars for all subcontracts under the same Work Breakdown Structure (WBS) ID and Control Account.

The importance of this check is to ensure that the budgeted amounts for subcontract work match the actual costs. If there is a misalignment, it could indicate errors in budgeting, cost reporting, or data entry. This could lead to inaccurate financial reporting and project management decisions based on incorrect data.

The severity of this check is marked as a WARNING. This means that while the data can still be reviewed, any misalignment between the subcontract budget dollars and the cost data is likely to cause problems during analysis. It is recommended that this issue be addressed to ensure accurate and reliable data for project management and financial reporting.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS08_WAD_AreSubKDollarsMisalignedWithDS03CA] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with SubcontractCA as (
		SELECT WBS_ID_CA, SUM(BCWSi_dollars) BCWSc
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND EOC = 'Subcontract'
		GROUP BY WBS_ID_CA
	)
	SELECT 
		W.*
	FROM
		DS08_WAD W INNER JOIN SubcontractCA C 	ON W.WBS_ID = C.WBS_ID_CA
												AND budget_subcontract_dollars <> C.BCWSc
	WHERE
			upload_ID = @upload_ID  
		AND TRIM(ISNULL(W.WBS_ID_WP,'')) = ''
)
```
