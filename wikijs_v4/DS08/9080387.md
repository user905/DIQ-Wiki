## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS08 WAD |
| Severity    | WARNING |
| Unique ID   | 9080387   |
| Summary     | Are the labor budget dollars for this WP/PP WAD misaligned with what is in cost? |
| Error message | budget_labor_dollars <> SUM(DS03.BCWSi_dollars) where EOC = labor (by WBS_ID_WP). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "WP Labor Dollars Misaligned With Cost" is designed to ensure that the labor budget dollars for each Work Package (WP) or Planning Package (PP) in the DS08 Work Authorization Document (WAD) table align with the corresponding cost in the DS03 Cost table.

The test is checking if the 'budget_labor_dollars' field in the DS08 WAD table is not equal to the sum of 'BCWSi_dollars' in the DS03 Cost table for each WP or PP where the Element of Cost (EOC) is 'Labor'. The 'WBS_ID_WP' field, which represents the Work Breakdown Structure ID for each WP or PP, is used to match the records in both tables.

If an error is flagged by this DIQ check, it indicates a discrepancy between the labor budget dollars and the actual cost for one or more WPs or PPs. This could be due to an error in data entry, a miscalculation in the budget, or a change in labor costs that has not been reflected in the budget. 

To resolve this issue, you should review the labor budget dollars and actual cost for each WP or PP and make necessary adjustments to ensure they align. The expected value for 'budget_labor_dollars' in the DS08 WAD table should be equal to the sum of 'BCWSi_dollars' in the DS03 Cost table for each WP or PP where the EOC is 'Labor'.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the labor budget dollars for a particular work package or planning package (WP/PP) within the DS08 WAD table align with the cost data. The test is comparing the budget labor dollars to the sum of the BCWSi dollars (Budgeted Cost of Work Scheduled) for labor in the DS03 table. 

The importance of this check is to ensure that the budgeted labor costs match the actual labor costs. If there is a discrepancy, it could indicate that labor costs are being mismanaged or inaccurately reported, which could lead to financial discrepancies and potential project overruns. 

The severity of this check is marked as a WARNING. This means that while the data can still be reviewed, any discrepancies found could cause problems during the analysis of the data. It's crucial to address these issues to ensure accurate financial tracking and project management.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS08_WAD_AreLaborDollarsMisalignedWithDS03WP] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with LaborWP as (
		SELECT WBS_ID_WP, SUM(BCWSi_dollars) BCWSc
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND EOC = 'Labor'
		GROUP BY WBS_ID_WP
	)
	SELECT 
		W.*
	FROM
		DS08_WAD W INNER JOIN LaborWP C ON W.WBS_ID_WP = C.WBS_ID_WP 
										AND budget_labor_dollars <> C.BCWSc
	WHERE
		upload_ID = @upload_ID  
)
```
