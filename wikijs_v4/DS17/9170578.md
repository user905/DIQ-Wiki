## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS17 WBS EU |
| Severity    | ALERT |
| Unique ID   | 9170578   |
| Summary     | Are the EU maximum dollars less than the cost EAC for this WBS / EOC combo? |
| Error message | EU_max_dollars < DS03.EAC by WBS_ID_WP & EOC. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "EU Max Dollars Less Than EAC (WP)" is performed on the DS17 WBS EU table. This check is designed to ensure that the maximum dollars for each EU (Estimate at Completion) are less than the cost EAC (Estimate at Completion) for the corresponding WBS (Work Breakdown Structure) / EOC (Estimate of Completion) combination.

If an error is flagged by this DIQ check, it indicates that the maximum dollars for an EU are not less than the cost EAC for the corresponding WBS / EOC combination. This discrepancy could be due to an error in data entry or calculation in the fields of EU maximum dollars or cost EAC.

The fields involved in this check are the EU maximum dollars from the DS17 WBS EU table and the cost EAC from the DS03 cost table. The check is performed by comparing the EU maximum dollars with the sum of ACWPi_dollars and ETCi_dollars (components of cost EAC) for each WBS / EOC combination.

The expected values for this check would be that the EU maximum dollars are less than the cost EAC for each WBS / EOC combination. If this is not the case, it may indicate a potential issue with the data that needs to be addressed.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the maximum dollars allocated to each work breakdown structure (WBS) / element of cost (EOC) combination under the 'DS17 WBS EU' table are less than the estimated cost at completion (EAC) for the same combination. The test is checking if 'EU_max_dollars' is less than 'DS03.EAC' by 'WBS_ID_WP' & 'EOC'. 

The importance of this check is to ensure that the budget allocated to each WBS/EOC combination is not exceeding the estimated cost at completion. This is crucial for effective project management and cost control. If the maximum dollars are more than the EAC, it could indicate a potential over-allocation of resources or a miscalculation in the budget.

The severity of this check is marked as an 'ALERT', which means it is not a critical error but could potentially cause minor problems or indicate that the data does not follow all best practices. It is a signal to review the data and correct any potential issues to ensure accurate and efficient project management.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS17_WBS_EU_IsEUMaxLtDS03EACWP] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with CostWPEAC as (
		SELECT WBS_ID_WP, EOC, SUM(ACWPi_dollars) + SUM(ETCi_dollars) EAC
		FROM DS03_cost
		WHERE upload_ID = @upload_ID
		GROUP BY WBS_ID_WP, EOC
	)
	SELECT 
		E.*
	FROM 
		DS17_WBS_EU E INNER JOIN CostWPEAC C ON E.WBS_ID = C.WBS_ID_WP AND E.EOC = C.EOC
	WHERE 
			upload_ID = @upload_ID
		AND E.EU_max_dollars < C.EAC
)
```
