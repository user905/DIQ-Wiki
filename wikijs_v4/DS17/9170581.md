## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS17 WBS EU |
| Severity    | ALERT |
| Unique ID   | 9170581   |
| Summary     | Is this time dependent WBS non-LOE in cost? |
| Error message | time_dependent = Y & DS03.EVT <> A (by WBS_ID). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "Non-LOE Time Dependence" is designed to ensure that all time-dependent Work Breakdown Structure (WBS) elements in the DS17 WBS EU table are correctly marked as Level of Effort (LOE) in the DS03 cost table. 

The error message "time_dependent = Y & DS03.EVT <> A (by WBS_ID)" indicates that there are WBS elements in the DS17 WBS EU table marked as time-dependent (time_dependent = 'Y') but are not marked as LOE (EVT <> 'A') in the DS03 cost table. 

The issue is likely caused by a discrepancy between the two tables. The WBS elements should be marked as LOE in the DS03 cost table if they are time-dependent in the DS17 WBS EU table. 

To resolve this issue, you should review the WBS elements in question and ensure that they are correctly marked in both tables. If a WBS element is time-dependent, it should be marked as LOE in the DS03 cost table.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test, titled "Non-LOE Time Dependence", is being performed on the 'DS17 WBS EU' table to check if the time-dependent Work Breakdown Structure (WBS) is non-Level of Effort (LOE) in cost. The test is checking for instances where the 'time_dependent' field is marked as 'Y' (Yes) and the event type (EVT) is not 'A' (LOE), grouped by the WBS_ID. 

The importance of this check is to ensure that all time-dependent costs are correctly classified. If a cost is time-dependent, it should not be classified as non-LOE, as this could lead to inaccuracies in cost tracking and project management. 

The severity of this check is marked as an 'ALERT', which means it is less severe but still important. It indicates that there might be minor problems or that the data doesn't follow all best practices. If not addressed, these issues could potentially cause problems during data analysis or project management.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS17_WBS_EU_IsTimeDepNonLOE] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with CostLOE as (
		SELECT WBS_ID_WP
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND EVT = 'A'
		GROUP BY WBS_ID_WP
	)
	SELECT 
		E.*
	FROM 
		DS17_WBS_EU E LEFT OUTER JOIN CostLOE C ON E.WBS_ID = C.WBS_ID_WP
	WHERE 
			upload_ID = @upload_ID
		AND time_dependent = 'Y'
		AND TRIM(ISNULL(C.WBS_ID_WP,'')) = ''
)
```
