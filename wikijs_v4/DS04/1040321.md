## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS04 Schedule |
| Severity    | ALERT |
| Unique ID   | 1040321   |
| Summary     | Are the early start or finish dates for the CD-4 milestone misaligned between FC & BL? |
| Error message | ES_date or EF_date do not align for CD-4 in the BL & FC schedules (schedule_type = FC & BL). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "CD-4 Early Start or Finish Dates Misaligned Between FC & BL" is designed to ensure that the early start (ES_date) or finish dates (EF_date) for the CD-4 milestone are consistent between the Forecast (FC) and Baseline (BL) schedules in the DS04 Schedule table.

If an error message is generated by this DIQ check, it indicates that there is a discrepancy between the early start or finish dates for the same task in the FC and BL schedules. This could be due to a data entry error or a change in one schedule that was not reflected in the other.

The fields causing the issue are the ES_date and EF_date fields in the DS04 Schedule table. The expected values for these fields should be the same for the same task in both the FC and BL schedules. If they are not, it suggests that the schedules are not aligned, which could lead to issues in project management and reporting. 

To resolve this issue, review the early start and finish dates for the CD-4 milestone in both schedules and ensure they are consistent. If they are not, determine which schedule is correct and update the other to match.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the early start or finish dates for the CD-4 milestone are aligned between the Forecast (FC) and Baseline (BL) schedules in the DS04 Schedule table. The alignment of these dates is crucial for accurate project planning and tracking. 

The severity of this test is marked as an ALERT, which means it's not a critical error but could potentially cause minor problems or indicate that the data doesn't adhere to all best practices. Misalignment of dates might lead to confusion, miscommunication, or incorrect analysis during project management. Therefore, it's important to address this issue to maintain the integrity and quality of the project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS04_Sched_AreCD4DatesMisalignedBtwFCAndBL] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with MS190 as (
		SELECT WBS_ID, task_ID, ES_date, EF_date, schedule_type
		FROM DS04_schedule 
		WHERE upload_ID = @upload_ID AND milestone_level = 190
	),Fails as (
		SELECT F.WBS_ID, F.task_id
		FROM MS190 F INNER JOIN MS190 B ON F.WBS_ID = B.WBS_ID
										AND F.task_ID = B.task_ID
		WHERE	F.schedule_type = 'FC' AND B.schedule_type = 'BL'
			AND (COALESCE(F.ES_date,F.EF_Date) <> COALESCE(B.ES_date,B.EF_date))
	)
	SELECT
		S.*
	FROM
		DS04_schedule S INNER JOIN Fails F ON S.task_ID = F.task_ID AND S.WBS_ID = F.WBS_ID
	WHERE
		S.upload_ID = @upload_ID
)
```
