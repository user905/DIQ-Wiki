## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS04 Schedule |
| Severity    | WARNING |
| Unique ID   | 9040278   |
| Summary     | Is this task's EVT mismatched with what is in cost? |
| Error message | Task EVT does not match what is in DS03 cost (by WBS ID). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled 'EVT Mismatch' is designed to ensure that the Earned Value Technique (EVT) for each task in the DS04 Schedule table matches the corresponding EVT in the DS03 Cost table. The EVT is categorized into four types: 'Discrete', 'LOE', 'PP', and 'Apportioned', based on the EVT codes. 

The error message 'Task EVT does not match what is in DS03 cost (by WBS ID)' indicates that there is a discrepancy between the EVT category of a task in the DS04 Schedule table and the corresponding EVT category in the DS03 Cost table for the same Work Breakdown Structure (WBS) ID. 

This discrepancy could be due to a variety of reasons such as data entry errors, changes in the task's EVT that were not updated in both tables, or inconsistencies in the categorization of the EVT codes. 

To resolve this issue, you should review the EVT codes for the tasks in both the DS04 Schedule and DS03 Cost tables and ensure that they are correctly categorized and consistent across both tables.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test, titled 'EVT Mismatch', is being performed on the 'DS04 Schedule' table to check if the Earned Value Technique (EVT) of a task matches with what is recorded in the DS03 cost table, using the Work Breakdown Structure (WBS) ID as a reference. The purpose of this test is to ensure consistency and accuracy between the schedule and cost data. 

The importance of this check lies in maintaining the integrity of the project management data. If the EVT of a task in the schedule does not match with the cost data, it could lead to inaccurate project cost forecasting, budgeting issues, and potential mismanagement of resources. 

The severity of this test has been marked as 'WARNING', which implies that while it may not immediately prevent the data from being reviewed, inconsistencies between the EVT and cost data are likely to cause problems during the analysis of the project's progress and financial status. Therefore, it is crucial to address this issue to ensure accurate and reliable project management and decision-making.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS04_Sched_IsEVTMismatchedWithDS03] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	--Step 1. Collect EVTs by their groupings in cost (group by WBS ID) & schedule (at task level) 
	--into temp tables.
	with ScheduleWBS as (
		SELECT 
			schedule_type, 
			WBS_ID,
			task_ID,
			CASE 
				WHEN EVT IN ('B', 'C', 'D', 'E', 'F', 'G', 'H', 'L', 'N', 'O', 'P') THEN 'Discrete'
				WHEN EVT = 'A' THEN 'LOE'
				WHEN EVT = 'K' THEN 'PP'
				WHEN EVT IN ('J', 'M') THEN 'Apportioned'
			END AS EVTCat
		FROM DS04_schedule
		WHERE upload_ID = @upload_ID
	), CostWBS as (
		SELECT
			WBS_ID_WP,
			CASE 
				WHEN EVT IN ('B', 'C', 'D', 'E', 'F', 'G', 'H', 'L', 'N', 'O', 'P') THEN 'Discrete'
				WHEN EVT = 'A' THEN 'LOE'
				WHEN EVT = 'K' THEN 'PP'
				WHEN EVT IN ('J', 'M') THEN 'Apportioned'
			END AS EVTCat
		FROM DS03_cost
		WHERE upload_ID = @upload_ID
	),
	--2. Compare the EVT groupings and insert into a cte, ToFlag.
	ToFlag as (
		SELECT
			S.schedule_type,
			S.WBS_ID,
			S.task_ID
		FROM
			ScheduleWBS S INNER JOIN CostWBS C ON S.WBS_ID = C.WBS_ID_WP AND S.EVTCat <> C.EVTCat
		GROUP BY S.schedule_type, S.WBS_ID, S.task_ID
	)
	--3. Use the output from above to gather results.
```
