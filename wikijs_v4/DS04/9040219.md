## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS04 Schedule |
| Severity    | WARNING |
| Unique ID   | 9040219   |
| Summary     | Does this task with units % complete have resources with an EOC other than material? |
| Error message | Task with units % complete type (PC_type = units) has non-material EOC resources (DS06.EOC <> material). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "Task With Units % Complete Not Materially Resource Loaded" is designed to ensure that tasks in the DS04 Schedule table, which are marked as having a percentage complete type (PC_type) of 'units', are only associated with resources that are materially loaded. 

This check is important because tasks with a 'units' PC_type should only be associated with resources that have an 'End of Contract' (EOC) type of 'material'. If the check finds tasks that are associated with resources of a different EOC type, it indicates a potential data integrity issue.

The error message "Task with units % complete type (PC_type = units) has non-material EOC resources (DS06.EOC <> material)" is displayed when the check finds tasks that are associated with non-material resources. This could be due to a data entry error or a misclassification of the resource's EOC type in the DS06 Schedule Resources table.

To resolve this issue, you should review the tasks and associated resources identified by the check. Ensure that the EOC type for each resource is correctly classified as 'material' in the DS06 Schedule Resources table. If a resource's EOC type is not 'material', you should consider whether the task's PC_type should be changed from 'units' or if the resource should be disassociated from the task.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed on the 'DS04 Schedule' table to check if tasks that are marked as a certain percentage complete have resources associated with them that are not materially resource loaded. The test is looking for instances where the task's percentage complete type (PC_type) is marked as 'units', but the resources associated with the task have an EOC (Estimate of Completion) that is not marked as 'material'. 

The importance of this check is to ensure that the data accurately reflects the resources used for tasks. If a task is marked as a certain percentage complete, but the resources associated with it are not materially resource loaded, it could indicate a discrepancy in the data. This could potentially lead to inaccurate project management decisions, as the resources used for tasks are a critical factor in project planning and execution.

The severity of this check is marked as 'WARNING', which means that while it is not an immediate threat to the data's integrity, it is likely to cause problems during analysis if not addressed. It is therefore recommended to fix this issue to ensure accurate and reliable data analysis.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS04_Sched_IsUnitsPCTypeResourcedWithNonMaterialEOC] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with NonMatRes as (
		SELECT schedule_type, task_ID 
		FROM DS06_schedule_resources 
		WHERE upload_ID = @upload_ID AND EOC <> 'material'
	)
	SELECT
		S.*
	FROM
		DS04_schedule S INNER JOIN NonMatRes R 	ON S.task_ID = R.task_ID
												AND S.schedule_type = R.schedule_type
	WHERE
			upload_id = @upload_ID
		AND PC_type = 'units'
)
```
