## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS04 Schedule |
| Severity    | ALERT |
| Unique ID   | 1040604   |
| Summary     | Is the calculated duration substantially different from the original duration? |
| Error message | |(EF_days - ES_days) / duration_original_days| > .25. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "Calculated & Original Durations Misaligned" is designed to identify any discrepancies between the calculated duration and the original duration in the DS04 Schedule table. This check is crucial for maintaining the accuracy and reliability of the project schedule data.

The error is likely to occur when the calculated duration, derived from the difference between the Early Start (ES) date and the Early Finish (EF) date, is significantly different from the original duration. Specifically, if the absolute value of the difference between the calculated duration and the original duration, divided by the original duration, is greater than 0.25, the DIQ check will flag this as an error. This means that the calculated duration is more than 25% different from the original duration.

Additionally, if the original duration is missing (i.e., is null or zero), but the calculated duration is greater than 5 days, this will also be flagged as an error. This is because a missing original duration coupled with a substantial calculated duration may indicate missing or incorrect data.

To resolve these errors, ensure that the original duration is correctly entered in the DS04 Schedule table and that it aligns closely with the calculated duration based on the ES and EF dates. If the original duration is missing, it should be added to the table. If the calculated duration is significantly different from the original duration, the ES and EF dates should be reviewed for accuracy.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test, titled "Calculated & Original Durations Misaligned", is being performed on the 'DS04 Schedule' table to check if there is a substantial difference between the calculated duration and the original duration of tasks in the EVMS construction project. The test is checking if the absolute value of the difference between the early finish (EF) days and early start (ES) days, divided by the original duration in days, is greater than 0.25. 

The importance of this check is to ensure that the project is on track and that there are no significant discrepancies between the planned and actual timelines. If the calculated duration is significantly different from the original duration, it could indicate problems with scheduling, resource allocation, or project management, which could potentially lead to delays or cost overruns. 

The severity of this test is marked as an 'ALERT', which means it is less severe but still important. It indicates that there might be minor problems or that the data doesn't follow all best practices. If the test fails, it doesn't necessarily mean that the data can't be reviewed, but it does suggest that there might be issues that need to be addressed to ensure the accuracy and reliability of the project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS04_Sched_IsCalculatedDurNEqToOrigDur] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	SELECT 
		*
	FROM 
		DS04_schedule
	WHERE
			upload_ID = @upload_ID
		AND (
				ISNULL(duration_original_days,0) = 0 AND DATEDIFF(day, ES_date, EF_date) > 5 
			OR ABS(
					(DATEDIFF(day, ES_date, EF_date) - ISNULL(duration_original_days,0)) / 
					NULLIF(duration_original_days,0)
				) > 0.25
		)
)
```
