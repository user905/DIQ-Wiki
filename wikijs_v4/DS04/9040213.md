## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS04 Schedule |
| Severity    | ALERT |
| Unique ID   | 9040213   |
| Summary     | Is this SVT not marked as external in the WBS dictionary (DS01)? |
| Error message | SVT (subtype = SVT) is not marked as external in the WBS dictionary (DS01.external = N). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "Non-External SVT" is designed to ensure that all Schedule Variance Thresholds (SVTs) in the DS04 Schedule table are correctly marked as external in the DS01 WBS dictionary. 

An error message will be generated if an SVT (identified by the subtype field in the DS04 Schedule table) is not marked as external in the DS01 WBS dictionary. This is indicated by the 'external' field in the DS01 WBS dictionary being set to 'N'. 

The likely cause of this error is a discrepancy between the DS04 Schedule and DS01 WBS dictionary tables. This could be due to a data entry error or a mismatch in the data synchronization between the two tables. 

To resolve this issue, ensure that all SVTs in the DS04 Schedule table are correctly marked as external in the DS01 WBS dictionary. The 'external' field in the DS01 WBS dictionary should be set to 'Y' for these SVTs.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to check if the Schedule Variance Threshold (SVT) is marked as external in the Work Breakdown Structure (WBS) dictionary. The test is checking the 'DS04 Schedule' table and is currently in the 'TEST' status. The severity of this test is marked as 'ALERT', which means it is of less severity but indicates there might be minor problems or that the data doesn't follow all best practices.

The importance of this check is to ensure that the SVT, which is a key parameter in project management, is correctly marked in the WBS dictionary. If the SVT is not marked as external, it could lead to misinterpretation of the data and potential issues in project management and analysis. This check helps maintain the integrity and quality of the project management data by ensuring that all parameters are correctly classified and marked.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS04_Sched_IsSVTNotExternal] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with NonExt as (
		SELECT WBS_ID, [external] 
		FROM DS01_WBS 
		WHERE upload_ID = @upload_ID AND [external] = 'N'
	)
	SELECT
		S.*
	FROM
		DS04_schedule S INNER JOIN NonExt E ON S.WBS_ID = E.WBS_ID
	WHERE
			upload_id = @upload_ID
		AND ISNULL(S.subtype,'') = 'SVT'
)
```
