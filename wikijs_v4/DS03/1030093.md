## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS03 Cost |
| Severity    | WARNING |
| Unique ID   | 1030093   |
| Summary     | Is this SLPP, WP, or PP lacking sufficient Overhead? (Minimally 10% of the total Budget by period) |
| Error message | Overhead BCWSi for this SLPP, WP, or PP makes up less than 10% of total budget for this period (on Dollars, Hours, or FTEs). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "Insufficient Overhead" is designed to identify any instances in the DS03 Cost table where the overhead for a specific SLPP, WP, or PP is less than 10% of the total budget for a given period. This check is performed on the basis of dollars, hours, or FTEs.

The fields that are primarily involved in this check are WBS_ID_CA, WBS_ID_WP, and period_date. The overhead is calculated using the BCWSi_Dollars, BCWSi_hours, and BCWSi_FTEs fields. The EOC field is also used to identify overhead costs.

If an error is flagged by this DIQ check, it is likely because the overhead costs (BCWSi_Dollars, BCWSi_hours, or BCWSi_FTEs) for a specific SLPP, WP, or PP (identified by WBS_ID_CA and WBS_ID_WP) in a particular period (period_date) make up less than 10% of the total budget for that period.

To resolve this issue, you should review the budget and overhead costs for the flagged SLPP, WP, or PP in the specified period. Ensure that the overhead costs are at least 10% of the total budget. If they are not, you may need to adjust the budget or overhead costs accordingly.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the overhead costs for each SLPP, WP, or PP in the DS03 Cost table are at least 10% of the total budget for the given period. Overhead costs are indirect costs that are not directly tied to a specific project activity but are necessary for the overall operation, such as administrative expenses, utilities, or security costs. 

The importance of this check is to ensure that overhead costs are being adequately accounted for in the budget. If overhead costs are too low, it could indicate that these costs are being overlooked or underestimated, which could lead to budget shortfalls in the future. This could potentially disrupt the project's progress and lead to financial issues.

The severity of this test is marked as a WARNING, which means that while it may not immediately prevent the data from being reviewed, it is likely to cause problems during analysis. If overhead costs are not properly accounted for, it could lead to inaccurate financial projections and poor decision making. Therefore, it is crucial to address this issue to ensure the accuracy and reliability of the project's financial data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS03_Cost_IsOverheadInsufficient] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with TotalS AS (
		--WP total budget
		SELECT 
			WBS_ID_CA CAID, WBS_ID_WP WPID, period_date Period,
			NULLIF(SUM(BCWSi_Dollars),0) D, NULLIF(SUM(BCWSi_hours),0) H, NULLIF(SUM(BCWSi_FTEs),0) F
		FROM DS03_cost
		WHERE upload_ID = @upload_ID
		GROUP BY WBS_ID_CA, WBS_ID_WP, period_date
	), OvhdS AS (
		--WP total overhead budget
		SELECT 
			WBS_ID_CA CAID, WBS_ID_WP WPID, period_date Period,
			SUM(BCWSi_Dollars) D, SUM(BCWSi_hours) H, SUM(BCWSi_FTEs) F
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND EOC = 'Overhead'
		GROUP BY WBS_ID_CA, WBS_ID_WP, period_date
	), Flags AS (
		--problematic WPs with ovhd < 10% total budget
		SELECT T.CAID, T.WPID, T.Period
		FROM TotalS T INNER JOIN OvhdS O 	ON T.CAID = O.CAID 
											AND T.WPID = O.WPID
											AND T.[Period] = O.[Period]
		WHERE 
			ABS(O.D / T.D) < .1 OR 
			ABS(O.H / T.H) < .1 OR 
			ABS(O.F / T.F) < .1
	)
	SELECT 
		C.* 
	FROM 
		DS03_Cost C INNER JOIN Flags F ON C.WBS_ID_CA = F.CAID
										AND C.WBS_ID_WP = F.WPID
										AND C.period_date = F.period
	WHERE
			upload_ID = @upload_ID
)
```
