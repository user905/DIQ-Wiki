## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS03 Cost |
| Severity    | WARNING |
| Unique ID   | 9030324   |
| Summary     | Is the EVT for this WP or PP misaligned with the EVT in the WAD? |
| Error message | DS03.EVT <> DS08.EVT (by WBS_ID_WP). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "WP / PP EVT Misaligned with WAD" is designed to identify any discrepancies between the Earned Value Technique (EVT) for a Work Package (WP) or Planning Package (PP) in the DS03 Cost table and the EVT in the DS08 Work Authorization Document (WAD) table. 

The EVT is a method used to measure the performance of a project. It is categorized into different groups such as 'Discrete', 'Level of Effort (LOE)', 'Apportioned', and 'Planning Package (PP)'. Each of these groups is represented by a specific set of codes. For example, 'Discrete' is represented by codes 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'L', 'N', 'O', 'P', 'LOE' is represented by code 'A', 'Apportioned' is represented by codes 'J', 'M', and 'PP' is represented by code 'K'.

The DIQ check is performed by comparing the EVT group of each WP or PP in the DS03 Cost table with the corresponding EVT group in the DS08 WAD table. The comparison is done based on the Work Breakdown Structure ID (WBS_ID_WP). If the EVT groups do not match, it indicates a misalignment between the two tables.

The likely cause of this error could be an incorrect entry in either the DS03 Cost table or the DS08 WAD table. It is important to ensure that the EVT for a WP or PP in the DS03 Cost table aligns with the EVT in the DS08 WAD table. If the EVT groups do not match, it may lead to inaccurate project performance measurement. Therefore, it is recommended to review and correct the EVT entries in both tables as necessary.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to check if the Earned Value Technique (EVT) for a particular Work Package (WP) or Planning Package (PP) is misaligned with the EVT in the Work Authorization Document (WAD). The test is comparing the EVT in the DS03 Cost table with the EVT in the DS08 table for each Work Breakdown Structure ID (WBS_ID_WP).

The importance of this check is to ensure that the cost management data is consistent across different tables and documents. If the EVT for a WP or PP is not aligned with the WAD, it could lead to inaccuracies in cost estimation and project management. This could further lead to issues in budgeting, scheduling, and overall project performance.

The severity of this check is marked as a WARNING. This means that while the data can still be reviewed, the misalignment is likely to cause problems during analysis. It is recommended to address this issue to ensure accurate and reliable project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS03_Cost_IsEVTMisalignedWithDS08] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with CostEVTGrps as (
		-- set DS03 EVT groups by WP/PP WBS
		SELECT 
			WBS_ID_WP,
			CASE
				WHEN EVT IN ('B', 'C', 'D', 'E', 'F', 'G', 'H', 'L', 'N', 'O', 'P') THEN 'Discrete'
				WHEN EVT = 'A' THEN 'LOE'
				WHEN EVT IN ('J', 'M') THEN 'Apportioned'
				WHEN EVT = 'K' THEN 'PP'
				ELSE ''
			END as EVT
		FROM DS03_cost
		WHERE upload_ID = @upload_ID AND TRIM(ISNULL(WBS_ID_WP,'')) <> ''
	), CostEVT as (
		-- group DS03 cost EVT by WP/PP WBS
		-- (this *is* doable in the above, but a separate cte is much neater)
		SELECT WBS_ID_WP, EVT
		FROM CostEVTGrps
		GROUP BY WBS_ID_WP, EVT
	), WADEVT as (
		-- get DS08 EVT for the last WAD revision
		-- use case to get the EVT by its EVT group
		SELECT 
			W.WBS_ID_WP, 
			CASE
				WHEN EVT IN ('B', 'D', 'E', 'F', 'G', 'H', 'L', 'N', 'O', 'P') THEN 'Discrete'
				WHEN EVT = 'A' THEN 'LOE'
				WHEN EVT IN ('J', 'M') THEN 'Apportioned'
				WHEN EVT = 'K' THEN 'PP'
				ELSE ''
			END as EVT
		FROM DS08_WAD W INNER JOIN LatestWPWADRev_Get(@upload_ID) R ON W.WBS_ID_WP = R.WBS_ID_WP 
																	AND W.auth_PM_date = R.PMAuth
		WHERE W.upload_ID = @upload_ID AND TRIM(ISNULL(W.WBS_ID_WP,'')) <> ''
	), Flags as (
		-- join the above by WBS ID & compare EVTs
		SELECT C.WBS_ID_WP
		FROM CostEVT C INNER JOIN WADEVT W 	ON C.WBS_ID_WP = W.WBS_ID_WP
											AND C.EVT <> W.EVT
		)
		SELECT 
			* 
		FROM 
			DS03_Cost
		WHERE
				upload_ID = @upload_ID
			AND WBS_ID_WP IN (SELECT WBS_ID_WP FROM Flags)
			AND (--Run the check only if WADs are at the WP/PP level.
				SELECT COUNT(*) 
				FROM DS08_WAD 
				WHERE upload_ID = @upload_ID AND TRIM(ISNULL(WBS_ID_WP,'')) <> ''
			) > 0
)
```
