## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS07 IPMR Header |
| Severity    | ALERT |
| Unique ID   | 9070362   |
| Summary     | Is the EAC PM likely considerably different from the BAC as reported in the WADs? |
| Error message | |(EAC_PM_likey_dollars - sum of DS08.budget_[EOC]_dollars) / sum of DS08.budget_[EOC]_dollars)| > .1 (Or delta > $1,000 where either value = 0). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "EAC PM Likely Incommensurate with WAD BAC" is designed to identify potential discrepancies between the Estimated At Completion (EAC) Project Management (PM) value and the Budget At Completion (BAC) as reported in the Work Authorization Documents (WADs). This check is performed on the DS07 IPMR Header table.

The check is triggered when the absolute difference between the EAC PM likely dollars and the sum of the DS08 budget dollars is greater than 10% or if the difference is greater than $1,000 when either value is zero. 

If the check fails, it is likely due to a significant discrepancy between the EAC PM likely dollars and the sum of the DS08 budget dollars. This could be caused by incorrect data entry in either the EAC PM likely dollars field in the DS07 IPMR Header table or in the budget dollars fields in the DS08 WAD table. 

To resolve this issue, you should review the data in these fields to ensure they are accurate and reflect the expected project costs. If the values are correct, you may need to investigate further to understand why there is a significant difference between the EAC PM likely dollars and the sum of the DS08 budget dollars.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure the accuracy and consistency of the Estimated at Completion (EAC) Project Management (PM) data in relation to the Budget at Completion (BAC) as reported in the Work Authorization Documents (WADs). The test is checking if the EAC PM is likely considerably different from the BAC. This is done by calculating the absolute difference between the EAC PM and the sum of the budget at the end of the contract (EOC) dollars, and dividing it by the sum of the budget EOC dollars. If this value is greater than 0.1, or the dollar difference is greater than $1,000 where either value equals 0, an alert is triggered.

The importance of this check is to ensure that the EAC PM is in line with the BAC. Significant discrepancies between these two values could indicate potential issues with budgeting or project management, which could lead to financial mismanagement or project delays. This check is classified as an ALERT, indicating that while it may not immediately prevent data review or cause problems during analysis, it is a potential issue that should be addressed to ensure best practices are being followed.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS07_IPMR_AreEACPMLikelyAndDS08BudgetsIncommensurate] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with BAC as (
		SELECT SUM(
			ISNULL(budget_labor_dollars,0) + 
			ISNULL(budget_material_dollars,0) + 
			ISNULL(budget_ODC_dollars,0) +
			ISNULL(budget_overhead_dollars,0) + 
			ISNULL(budget_subcontract_dollars,0)
		) BAC
		FROM DS08_WAD
		WHERE upload_ID = @upload_ID
	)
	SELECT 
		*
	FROM
		DS07_IPMR_header
	WHERE
			upload_ID = @upload_ID
		AND (
			(	--if either is zero, flag if either is more than $1000.
				(ISNULL(EAC_PM_likely_dollars,0) = 0 OR (SELECT TOP 1 BAC FROM BAC) = 0) 
			AND ABS(ISNULL(EAC_PM_likely_dollars,0) - (SELECT TOP 1 BAC FROM BAC)) > 1000)
				--otherwise, flag if the difference is more than 10%.
			OR ABS((ISNULL(EAC_PM_likely_dollars,0) - (SELECT TOP 1 BAC FROM BAC)) / NULLIF((SELECT TOP 1 BAC FROM BAC),0)) > .1
		)
)
```
