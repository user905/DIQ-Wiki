## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS07 IPMR Header |
| Severity    | WARNING |
| Unique ID   | 9070308   |
| Summary     | Is the PM EAC Likely date later than the CD-4 milestone? |
| Error message | EAC_PM_Likely_date > minimum DS04.EF_date where milestone_level = 190 (FC only). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "PM EAC Likely Date After CD-4" is designed to ensure that the Project Manager's Estimated At Completion (EAC) Likely date is not set to a date later than the CD-4 milestone. This check is performed on the data in the DS07 IPMR Header table.

If an error is flagged by this DIQ check, it is likely because the EAC_PM_Likely_date field in the DS07 IPMR Header table is set to a date that is later than the earliest EF_date (Effective Date) for the CD-4 milestone in the DS04 Schedule table. The CD-4 milestone is identified by a milestone_level value of 190 and a schedule_type of 'FC'.

To resolve this issue, ensure that the EAC_PM_Likely_date is not later than the CD-4 milestone date. The EAC_PM_Likely_date should be set to a date that is on or before the earliest EF_date for the CD-4 milestone in the DS04 Schedule table.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed on the 'DS07 IPMR Header' table to check if the Project Manager's (PM) Estimated At Completion (EAC) Likely date is later than the Critical Decision-4 (CD-4) milestone. The CD-4 milestone represents the project completion and start of operations. The test is checking if the EAC_PM_Likely_date is greater than the minimum DS04.EF_date where the milestone level is 190 (Final Completion only).

The importance of this check is to ensure that the project's estimated completion date is not set after the project has already been marked as complete. This could lead to inconsistencies in project tracking and management, potentially causing confusion and miscommunication among the project team and stakeholders. 

The severity of this check is marked as 'WARNING', which means that while it may not prevent the data from being reviewed, it is likely to cause problems during analysis. It is crucial to address this issue to maintain the accuracy and reliability of the project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS07_IPMR_IsEACPMLikelyGtCD4] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with CD4 as (
		SELECT MIN(EF_date) MinEF
		FROM DS04_schedule
		WHERE upload_ID = @upload_ID AND milestone_level = 190 AND schedule_type = 'FC'
	)
	SELECT 
		*
	FROM
		DS07_IPMR_header
	WHERE
			upload_ID = @upload_ID
		AND EAC_PM_likely_date > (SELECT TOP 1 MinEF FROM CD4)
)
```
