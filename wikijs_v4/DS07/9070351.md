## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS07 IPMR Header |
| Severity    | WARNING |
| Unique ID   | 9070351   |
| Summary     | Is the stated CBB value in the IPMR header plus the cost Overrun equal to the PMB plus MR? |
| Error message | CBB_dollars <> PMB (DS03.DB + DS07.UB_bgt) + MR_bgt + MR_rpg - Overrun (Sum of DS03.BAC_rpg). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "CBB Misaligned with PMB, MR, & Overrun" is designed to ensure that the stated Contract Budget Base (CBB) value in the DS07 IPMR Header table aligns with the sum of the Performance Measurement Baseline (PMB), Management Reserve (MR), and cost overrun. 

The check is performed by comparing the CBB value with the sum of PMB (which is the sum of DB from DS03 and UB_bgt from DS07), MR (which is the sum of MR_bgt and MR_rpg), and the cost overrun (which is the sum of BAC_rpg from DS03). 

If the DIQ check fails, it means that the CBB value does not match the calculated sum of PMB, MR, and cost overrun. This discrepancy could be due to incorrect or missing values in the fields used to calculate the PMB, MR, or cost overrun. 

For instance, the DB field in DS03, or the UB_bgt, MR_bgt, or MR_rpg fields in DS07 could contain incorrect values. Alternatively, the BAC_rpg field in DS03, which is used to calculate the cost overrun, could also be incorrect or missing. 

The expected values for these fields should align with the project's budget and cost data. The CBB should equal the sum of the PMB, MR, and cost overrun. If it does not, the values in these fields should be reviewed and corrected as necessary.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the Contract Budget Base (CBB) value stated in the Integrated Program Management Report (IPMR) header is correctly aligned with the Performance Measurement Baseline (PMB), Management Reserve (MR), and cost Overrun. The test checks if the sum of the CBB value and the cost Overrun is equal to the sum of the PMB and MR. 

The importance of this check lies in maintaining the accuracy and consistency of financial data in the project management system. If the CBB is not aligned with the PMB, MR, and Overrun, it could lead to incorrect financial reporting and mismanagement of the project budget. This could further result in inaccurate project forecasting and decision-making. 

The severity of this test is marked as a WARNING, which implies that if this issue is not addressed, it is likely to cause problems during the analysis of the project's financial data. It may not stop the data from being reviewed, but it could potentially lead to incorrect interpretations and decisions based on that data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS07_IPMR_IsCBBNEqToPMBPlusMRMinusOverrun] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with Cost as (
		SELECT SUM(BCWSi_dollars) DB, SUM(ISNULL(BAC_rpg,0)) Rpg
		FROM DS03_cost
		WHERE upload_ID = @upload_ID
	)
	SELECT 
		*
	FROM
		DS07_IPMR_header
	WHERE
			upload_ID = @upload_ID
		AND CBB_dollars <> (SELECT DB FROM Cost) + ISNULL(UB_bgt_dollars,0) + --PMB
							ISNULL(MR_bgt_dollars,0) + ISNULL(MR_rpg_dollars,0) - --MR
							(SELECT Rpg FROM Cost) --overrun
)
```
