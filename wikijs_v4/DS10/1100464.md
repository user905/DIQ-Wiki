## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS10 CC Log Detail |
| Severity    | WARNING |
| Unique ID   | 1100464   |
| Summary     | Is this DB transaction missing a WBS ID? |
| Error message | category = DB & WBS_ID is missing or blank. |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "DB Transaction Missing WBS ID" is designed to identify any database transactions in the DS10 CC Log Detail table that are missing a Work Breakdown Structure (WBS) ID. 

The WBS ID is a critical field that should be present in every transaction. It is used to identify the specific task or project component that the transaction is associated with. If a transaction is missing a WBS ID, it may indicate that the transaction was not properly recorded or that there is an issue with the data entry process.

The DIQ check specifically looks for transactions where the 'category' field is marked as 'DB' (indicating a database transaction) and the 'WBS_ID' field is either missing or blank. If such transactions are found, they are flagged for review.

To resolve this issue, you should review the flagged transactions and ensure that a valid WBS ID is entered for each one. If the WBS ID is missing because the transaction is not associated with a specific task or project component, you may need to review your data entry procedures to ensure that all transactions are properly categorized and recorded.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to check if there are any database transactions in the 'DS10 CC Log Detail' table that are missing a Work Breakdown Structure (WBS) ID. The WBS ID is crucial for project management as it helps in organizing work into manageable sections, making it easier to manage and track project progress. 

The severity of this test is marked as 'WARNING', which means that while it may not prevent the data from being reviewed, it is likely to cause problems during analysis. If a DB transaction is missing a WBS ID, it could lead to difficulties in tracking the progress of that particular transaction, potentially leading to mismanagement or delays in the project. 

Therefore, this check is important to ensure that all database transactions are properly labeled with a WBS ID, allowing for efficient project management and accurate data analysis.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS10_CCLogDetails_IsDBTransactionMissingWBSID] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	with Dupes as (
		SELECT transaction_id
		FROM DS10_CC_log_detail
		WHERE upload_ID = @upload_ID
		GROUP BY transaction_id
		HAVING COUNT(*) > 1
	)
	SELECT 
		*
	FROM 
		DS10_CC_log_detail
	WHERE 
		upload_ID = @upload_ID
	AND category = 'DB'
	AND TRIM(ISNULL(WBS_ID,'')) = ''
)
```
