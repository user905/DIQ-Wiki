## Basic Information
| Key         | Value          |
|-------------|----------------|
| Table       | DS10 CC Log Detail |
| Severity    | WARNING |
| Unique ID   | 9100472   |
| Summary     | Is the POP finish for this Work Package misaligned with what is in the WAD? |
| Error message | POP_finish_date <> DS08.POP_finish_date (select latest revision; check is on WP/PP level). |

## What causes this error?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

The Data Integrity and Quality (DIQ) check titled "POP Finish Misaligned with WAD (WP)" is designed to ensure that the Planned Operation Period (POP) finish date for a given Work Package (WP) aligns with the corresponding date in the Work Authorization Document (WAD) as recorded in DS08. 

The check is performed on the DS10 CC Log Detail table, specifically comparing the 'POP_finish_date' field in DS10 with the 'POP_finish_date' field in DS08. The check is performed at the WP/PP level, and the results are grouped by the 'WBS_ID' field.

If an error is flagged by this DIQ check, it indicates that there is a discrepancy between the POP finish dates recorded in DS10 and DS08 for a given WP. This could be due to a data entry error, a delay in updating one of the tables, or a change in the project schedule that has not been consistently reflected across all data sources.

To resolve this issue, you should review the relevant WPs and ensure that the POP finish dates in DS10 and DS08 are consistent. If they are not, you will need to update the incorrect date to match the correct one. The expected value for the 'POP_finish_date' field in DS10 should be the same as the 'POP_finish_date' in DS08 for the same WP.
## Why do we check this?

> :robot: The following text was generated by an AI tool and hasn't been reviewed for accuracy by a human! It might be useful, but it also might have errors. Are you a human? You can help by reviewing it for accuracy! Edit it as needed then remove this message.
{.is-warning}

This test is being performed to ensure that the Planned Outage Period (POP) finish date for a specific Work Package (WP) aligns with the date recorded in the Work Authorization Document (WAD). The test is comparing the POP finish date in the 'DS10 CC Log Detail' table with the POP finish date in the 'DS08' table. 

The importance of this check is to maintain consistency and accuracy in project scheduling and planning. Misalignment of dates can lead to confusion, miscommunication, and potential delays in the project timeline. 

The severity of this test is marked as a 'WARNING', which means that while it may not immediately prevent the data from being reviewed, it is likely to cause problems during analysis. Therefore, it is crucial to address this issue to ensure accurate and reliable project management data.
## Code

```sql

CREATE FUNCTION [dbo].[fnDIQ_DS10_CCLogDetails_IsPOPFinishMisalignedWithDS08WP] (
	@upload_id int = 0
)
RETURNS TABLE
AS RETURN
(
	
	WITH WADFinish AS (
		--Last WP WAD with POP Finish
		SELECT 
			W.WBS_ID_WP, POP_finish_date
		FROM 
			DS08_WAD W INNER JOIN (
					SELECT WBS_ID_WP, MAX(auth_PM_date) AS lastPMAuth
					FROM DS08_WAD
					WHERE upload_ID = @upload_ID
					GROUP BY WBS_ID_WP
				) LastRev 	ON W.WBS_ID_WP = LastRev.WBS_ID_WP 
							AND W.auth_PM_date = LastRev.lastPMAuth
	)
	SELECT 
		L.*
	FROM 
		DS10_CC_log_detail L INNER JOIN WADFinish W ON L.WBS_ID = W.WBS_ID_WP
	WHERE 
		upload_ID = @upload_ID
	AND L.POP_finish_date <> W.POP_finish_date
)
```
